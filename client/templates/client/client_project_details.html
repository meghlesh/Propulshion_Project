{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Project Details | Propulsion</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Alpine.js for interactivity -->
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <!-- Google Fonts: Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
          theme: {
            extend: {
              fontFamily: {
                sans: ['Poppins', 'sans-serif'],
              },
              colors: {
                'primary-green': '#053830',        
                'primary-green-hover': '#155C54', 
                'accent-green': '#D2E8B8',        
                'highlight-gold': '#FF9728',        
                'gold-hover': '#e0851f',
              },
              animation: {
                'float': 'float 3s ease-in-out infinite',
                'float-delayed': 'float 3s ease-in-out 1.5s infinite',
                'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                'draw': 'draw 2s ease-out forwards',
                'spin-slow': 'spin 12s linear infinite',
                'spin-slower': 'spin 20s linear infinite',
                'spin-reverse': 'spin 15s linear infinite reverse',
                'rocket-shake': 'rocket-shake 0.5s cubic-bezier(.36,.07,.19,.97) infinite',
                'cloud-move': 'cloud-move 3s linear infinite',
                'scan': 'scan 3s linear infinite',
                'ping-slow': 'ping 3s cubic-bezier(0, 0, 0.2, 1) infinite',
              },
              keyframes: {
                float: {
                    '0%, 100%': { transform: 'translateY(0)' },
                    '50%': { transform: 'translateY(-10px)' },
                },
                draw: {
                    '0%': { strokeDashoffset: '1000' },
                    '100%': { strokeDashoffset: '0' },
                },
                'rocket-shake': {
                    '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                    '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                    '30%, 50%, 70%': { transform: 'translate3d(-2px, 0, 0)' },
                    '40%, 60%': { transform: 'translate3d(2px, 0, 0)' }
                },
                'cloud-move': {
                    '0%': { transform: 'translateY(0)', opacity: '0' },
                    '20%': { opacity: '1' },
                    '100%': { transform: 'translateY(20px)', opacity: '0' }
                },
                'scan': {
                    '0%': { left: '-100%' },
                    '100%': { left: '200%' }
                }
              }
            }
          }
        }
    </script>

    <style>
        body { font-family: 'Poppins', sans-serif; }
        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(5, 56, 48, 0.05);
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #155C54; border-radius: 10px; }
        
        /* Timeline / Gantt Styles */
        .timeline-line {
            position: absolute;
            left: 24px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e2e8f0;
            z-index: 0;
        }

        /* Mobile safe area spacing */
        .safe-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* 3D Card Styles */
        .perspective-1000 {
            perspective: 1000px;
        }
        .transform-style-3d {
            transform-style: preserve-3d;
        }
    </style>
</head>
<body class="bg-[#e2e8f0] text-slate-800 h-screen overflow-hidden flex" x-data="{ activeTab: 'overview', mobileMenuOpen: false }">

    <!-- ===========================
          MOBILE SIDEBAR OVERLAY
    ============================ -->
    <div x-show="mobileMenuOpen" class="fixed inset-0 z-50 md:hidden" role="dialog" aria-modal="true" style="display: none;">
        <!-- Backdrop -->
        <div x-show="mobileMenuOpen" 
             x-transition:enter="transition-opacity ease-linear duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition-opacity ease-linear duration-300"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 bg-black/60 backdrop-blur-sm"
             @click="mobileMenuOpen = false"></div>

        <!-- Slide-out Panel -->
        <div x-show="mobileMenuOpen" 
             x-transition:enter="transition ease-in-out duration-300 transform"
             x-transition:enter-start="-translate-x-full"
             x-transition:enter-end="translate-x-0"
             x-transition:leave="transition ease-in-out duration-300 transform"
             x-transition:leave-start="translate-x-0"
             x-transition:leave-end="-translate-x-full"
             class="fixed inset-y-0 left-0 w-72 bg-primary-green text-white shadow-2xl flex flex-col h-full safe-bottom">
            
            <!-- Mobile Brand -->
            <div class="p-6 flex items-center justify-between border-b border-white/10">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center border border-white/10 text-highlight-gold font-extrabold text-xl">P</div>
                    <span class="font-bold text-lg">Propulsion</span>
                </div>
                <button @click="mobileMenuOpen = false" class="text-white/70 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>

            <!-- Mobile Nav -->
            <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto">
                <p class="text-xs font-semibold text-gray-400 uppercase tracking-widest px-4 pb-2">Main Menu</p>
                
                <a href="{% url 'client:client_dashboard' %}" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-300 hover:text-white hover:bg-white/5 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                    <span class="font-medium">Dashboard</span>
                </a>

                <a href="{% url 'client:client_projects' %}" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-300 hover:text-white hover:bg-white/5 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                    <span class="font-medium">Projects</span>
                </a>

                

                <!-- Active Page Indicator -->
                <div class="flex items-center gap-3 px-4 py-3 rounded-xl bg-primary-green-hover border-l-4 border-highlight-gold text-white shadow-lg">
                    <svg class="w-5 h-5 text-highlight-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                    <span class="font-medium">Project Details</span>
                </div>

                
            </nav>

            <!-- User Info Mobile -->
            <div class="p-4 border-t border-white/10">
                <div class="flex items-center gap-3 p-3 rounded-xl bg-white/5">
                    <div class="w-8 h-8 rounded-full bg-highlight-gold text-primary-green flex items-center justify-center font-bold text-xs">
                        {{ user.username|slice:":1"|upper|default:"J" }}
                    </div>
                    <div>
                        <p class="text-sm font-medium text-white">{{ user.username }}</p>
                        <p class="text-xs text-white/50">Client Account</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================
          DESKTOP SIDEBAR
    ============================= -->
    <aside class="w-72 bg-primary-green text-white hidden md:flex flex-col relative z-20 shadow-2xl h-full shrink-0">
        <div class="absolute top-0 left-0 w-full h-64 bg-highlight-gold blur-[120px] opacity-10 pointer-events-none"></div>

        <div class="p-8 z-10 flex items-center gap-3 shrink-0">
            <div class="w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center border border-white/10 backdrop-blur-sm text-highlight-gold font-extrabold text-xl shadow-lg">P</div>
            <div>
                <h1 class="text-xl font-bold tracking-tight leading-none">Propulsion</h1>
                <span class="text-[10px] text-gray-400 uppercase tracking-widest">Client Portal</span>
            </div>
        </div>

        <nav class="flex-1 px-4 space-y-1 z-10 overflow-y-auto sidebar-nav pb-4 custom-scrollbar">
            <p class="text-xs font-semibold text-gray-400 uppercase tracking-widest px-4 pt-4 pb-2">Main Menu</p>
            
            <a href="{% url 'client:client_dashboard' %}" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-300 hover:text-white hover:bg-white/5 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                <span class="font-medium">Dashboard</span>
            </a>

            <a href="{% url 'client:client_projects' %}" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-300 hover:text-white hover:bg-white/5 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                <span class="font-medium">Projects</span>
            </a>

            <div class="flex items-center gap-3 px-4 py-3 rounded-xl bg-primary-green-hover border-l-4 border-highlight-gold text-white shadow-lg">
                <svg class="w-5 h-5 text-highlight-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                <span class="font-medium">Project Details</span>
            </div>

                    <a href="{% url 'client:client_personal_documents' %}" 
           class="flex items-center gap-3 px-4 py-3.5 rounded-xl 
           {% if request.resolver_match.url_name == 'client_personal_documents' %} 
               bg-primary-green-hover border-l-4 border-highlight-gold text-white shadow-lg shadow-black/20
           {% else %}
               text-gray-300 hover:bg-primary-green-hover hover:text-white
           {% endif %}
           transition-all group">
            <svg class="w-5 h-5 {% if request.resolver_match.url_name == 'client_personal_documents' %}text-highlight-gold{% else %}group-hover:text-highlight-gold{% endif %}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9l-6-6H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
            <span class="font-medium">Personal Documents</span>
        </a>
        <a href="{% url 'client:client_payments' %}"
           class="flex items-center gap-3 px-4 py-3.5 rounded-xl 
           {% if request.resolver_match.url_name == 'client_payments' %} 
               bg-primary-green-hover border-l-4 border-highlight-gold text-white shadow-lg shadow-black/20
           {% else %}
               text-gray-300 hover:bg-primary-green-hover hover:text-white
           {% endif %}
           transition-all group">
            <svg class="w-5 h-5 {% if request.resolver_match.url_name == 'client_payments' %}text-highlight-gold{% else %}group-hover:text-highlight-gold{% endif %}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" /></svg>
            <span class="font-medium">Payments</span>
        </a>
        </nav>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 flex flex-col h-full relative overflow-hidden w-full">
        
        <!-- Header -->
        <header class="h-16 md:h-20 glass w-full flex items-center justify-between px-4 md:px-8 sticky top-0 z-30 transition-all">
            <div class="flex items-center gap-4">
                <!-- Mobile Menu Toggle -->
                <button class="md:hidden text-slate-500 p-2 -ml-2 hover:bg-slate-100 rounded-lg transition" @click="mobileMenuOpen = !mobileMenuOpen">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
                </button>

                <!-- Back Button -->
                <div class="flex items-center gap-2 md:gap-4">
                    <a href="{% url 'client:client_dashboard' %}" class="text-slate-400 hover:text-primary-green transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                    </a>
                    <h2 class="text-lg font-semibold text-slate-700 hidden sm:block">Back to Dashboard</h2>
                </div>
            </div>
            
          <!-- Profile Dropdown -->
                <div class="relative" x-data="{ userMenuOpen: false }">
                    <div @click="userMenuOpen = !userMenuOpen" @click.outside="userMenuOpen = false" class="flex items-center gap-2 md:gap-3 cursor-pointer hover:bg-white p-1 md:p-1.5 md:pr-4 rounded-full transition border border-transparent hover:border-gray-200 select-none">
                        <div class="w-8 h-8 md:w-9 md:h-9 bg-highlight-gold rounded-full shadow-md flex items-center justify-center text-white font-bold text-xs md:text-sm">
                            {{ user.username|slice:":1"|upper|default:"J" }}
                        </div>
                        <div class="hidden md:block">
                            <p class="text-sm font-bold text-primary-green leading-tight">{{ user.username|default:"Guest User" }}</p>
                            <p class="text-[10px] text-slate-400 uppercase tracking-wider font-bold">Client</p>
                        </div>
                        <svg :class="{'rotate-180': userMenuOpen}" class="w-4 h-4 text-slate-400 transition-transform duration-200 hidden md:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>

                    <!-- Dropdown Menu -->
                    <div x-show="userMenuOpen" 
                         x-transition:enter="transition ease-out duration-100"
                         x-transition:enter-start="opacity-0 scale-95"
                         x-transition:enter-end="opacity-100 scale-100"
                         x-transition:leave="transition ease-in duration-75"
                         x-transition:leave-start="opacity-100 scale-100"
                         x-transition:leave-end="opacity-0 scale-95"
                         class="absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-2xl border border-slate-100 py-1 z-50 overflow-hidden origin-top-right">
                         
                        <div class="px-4 py-3 border-b border-slate-50 md:hidden">
                            <!-- Mobile-only User Info inside dropdown -->
                            <p class="text-sm font-bold text-slate-700 truncate">{{ user.username|default:"Guest User" }}</p>
                            <p class="text-xs text-slate-400">{{ user.email|default:"user@example.com" }}</p>
                        </div>
                         
                        <div class="px-4 py-3 border-b border-slate-50 hidden md:block">
                            <p class="text-xs text-slate-400 font-semibold uppercase">Account</p>
                            <p class="text-sm font-bold text-slate-700 truncate">{{ user.email|default:"user@example.com" }}</p>
                        </div>

                        <a href="#" class="block px-4 py-2 text-sm text-slate-600 hover:bg-slate-50 hover:text-primary-green transition flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                            My Profile
                        </a>
                        <a href="#" class="block px-4 py-2 text-sm text-slate-600 hover:bg-slate-50 hover:text-primary-green transition flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                            Settings
                        </a>
                        
                        <div class="h-px bg-slate-100 my-1"></div>
                        
                        <!-- Logout Link -->
                        <a href="{% url 'client:client_logout' %}" class="block px-4 py-2 text-sm text-red-500 hover:bg-red-50 transition flex items-center gap-2 font-medium">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                            Logout
                        </a>
                    </div>
        </header>

        <!-- Scrollable Content -->
        <div class="flex-1 overflow-y-auto p-4 md:p-8 scroll-smooth relative w-full">
            
            <div class="max-w-6xl mx-auto space-y-6 safe-bottom">

                <!-- Project Header Card -->
                <div class="bg-white rounded-3xl p-6 md:p-8 border border-slate-100 shadow-xl relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-40 h-40 bg-accent-green/20 rounded-full -mr-10 -mt-10"></div>
                    
                    <div class="relative z-10 flex flex-col md:flex-row justify-between items-start md:items-center gap-6 md:gap-4">
                        <div class="w-full md:w-auto">
                            <div class="flex flex-wrap items-center gap-3 mb-2">
                                <span class="px-3 py-1 rounded-full text-xs font-bold
                                    {% if project.status == 'Completed' %} bg-green-100 text-green-700 border border-green-200
                                    {% elif project.status == 'In Progress' %} bg-blue-50 text-blue-600 border border-blue-100
                                    {% else %} bg-yellow-50 text-yellow-700 border border-yellow-100 {% endif %}">
                                    {{ project.status }}
                                </span>
                                <span class="text-slate-400 text-sm font-medium">ID: #PROP-{{ project.id|stringformat:"06d" }}</span>
                            </div>
                            <h1 class="text-2xl md:text-3xl font-bold text-primary-green leading-tight">{{ project.project_name }}</h1>
                            <p class="text-slate-500 mt-1 text-sm md:text-base">
                                {% if project.client and project.client.company_name %}
                                    {{ project.client.company_name }} â€¢
                                {% endif %}
                                {% if project.end_date %}
                                    Due Date: {{ project.end_date|date:"M d, Y" }}
                                {% else %}
                                    Start Date: {{ project.start_date|date:"M d, Y" }}
                                {% endif %}
                            </p>
                        </div>
                        
                        <div class="flex flex-wrap gap-3 w-full md:w-auto">
                            <a href="{% if project.brief %}{{ project.brief.url }}{% else %}#{% endif %}" class="flex-1 md:flex-none text-center px-5 py-2.5 bg-white border border-slate-200 text-slate-600 font-semibold rounded-xl hover:bg-slate-50 transition shadow-sm text-sm">
                                Download Brief
                            </a>
                            <!-- Message Team button removed here -->
                        </div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="mt-8">
                        <div class="flex justify-between items-end mb-2">
                            <span class="text-sm font-bold text-slate-700">Project Progress</span>
                            <span class="text-sm font-bold text-highlight-gold">{{ progress|default:0 }}%</span>
                        </div>
                        <div class="w-full bg-slate-100 h-3 rounded-full overflow-hidden">
                            <div class="bg-gradient-to-r from-primary-green to-emerald-500"
                                 style="width: {{ progress|default:0 }}%; height:100%; border-radius:999px;">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabs Navigation -->
                <div class="flex items-center gap-2 border-b border-slate-200 pb-1 overflow-x-auto no-scrollbar">
                    <button @click="activeTab = 'overview'" :class="{'border-b-2 border-highlight-gold text-primary-green': activeTab === 'overview', 'text-slate-500 hover:text-slate-700': activeTab !== 'overview'}" class="px-4 md:px-6 py-3 font-semibold text-sm transition-all whitespace-nowrap">Overview</button>
                    <button @click="activeTab = 'timeline'" :class="{'border-b-2 border-highlight-gold text-primary-green': activeTab === 'timeline', 'text-slate-500 hover:text-slate-700': activeTab !== 'timeline'}" class="px-4 md:px-6 py-3 font-semibold text-sm transition-all whitespace-nowrap">Timeline & Tasks</button>
                    <button @click="activeTab = 'documents'" :class="{'border-b-2 border-highlight-gold text-primary-green': activeTab === 'documents', 'text-slate-500 hover:text-slate-700': activeTab !== 'documents'}" class="px-4 md:px-6 py-3 font-semibold text-sm transition-all whitespace-nowrap">Documents</button>
                    <button @click="activeTab = 'payments'" :class="{'border-b-2 border-highlight-gold text-primary-green': activeTab === 'payments', 'text-slate-500 hover:text-slate-700': activeTab !== 'payments'}" class="px-4 md:px-6 py-3 font-semibold text-sm transition-all whitespace-nowrap">Payments</button>
                </div>

                <!-- CONTENT: OVERVIEW TAB -->
                <div x-show="activeTab === 'overview'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 transform translate-y-4" x-transition:enter-end="opacity-100 transform translate-y-0" class="mt-6">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Description -->
                        <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                            <h3 class="font-bold text-lg text-primary-green mb-4">Project Description</h3>
                            <p class="text-slate-600 leading-relaxed text-sm">
                                {{ project.description|default:"No description provided for this project." }}
                            </p>

                            <h3 class="font-bold text-lg text-primary-green mt-8 mb-4">Key Deliverables</h3>
<ul class="space-y-3">
    {% if project.deliverables %}
        {% for item in project.deliverables.splitlines %}
            {% if item != "" %}
                <li class="flex items-start gap-3 text-sm text-slate-600">
                    <!-- check icon -->
                    <svg class="w-5 h-5 text-green-500 flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                    <span class="leading-relaxed break-words">{{ item }}</span>
                </li>
            {% endif %}
        {% endfor %}
    {% else %}
        <li class="flex items-start gap-3 text-sm text-slate-600">
            <svg class="w-5 h-5 text-green-500 flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            <span class="leading-relaxed break-words">High-fidelity UI Mockups (Figma)</span>
        </li>
        <li class="flex items-start gap-3 text-sm text-slate-600">
            <svg class="w-5 h-5 text-green-500 flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            <span class="leading-relaxed break-words">Frontend Codebase (React + Tailwind)</span>
        </li>
    {% endif %}
</ul>

                        </div>

                        <!-- Team & Info -->
                        <div class="space-y-6">
                            
                            <!-- Campaign Boost Card (Replaced Live Engagement) -->
                            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden">
                                <!-- Background decoration -->
                                <div class="absolute inset-0 bg-gradient-to-b from-white to-blue-50/50"></div>
                                <div class="absolute top-0 right-0 p-8 opacity-5">
                                    <svg class="w-32 h-32" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                                </div>
                                
                                <div class="relative z-10">
                                    <div class="flex justify-between items-start mb-4">
                                        <div>
                                            <h3 class="font-bold text-sm text-slate-400 uppercase tracking-wider mb-1">Campaign Velocity</h3>
                                            <div class="flex items-baseline gap-2">
                                                <span class="text-3xl font-bold text-primary-green">+128%</span>
                                                <span class="text-xs font-semibold text-green-500 bg-green-100 px-1.5 py-0.5 rounded">Trending Up</span>
                                            </div>
                                        </div>
                                        <div class="w-10 h-10 bg-slate-50 rounded-full flex items-center justify-center text-slate-300">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                                        </div>
                                    </div>

                                    <!-- Rocket Animation Scene -->
                                    <div class="h-32 w-full relative flex items-center justify-center bg-blue-50/30 rounded-xl overflow-hidden border border-blue-100/50">
                                        <!-- Animated Clouds/Particles -->
                                        <div class="absolute inset-0 flex justify-center">
                                            <div class="w-1 h-1 bg-slate-300 rounded-full absolute top-10 left-10 animate-cloud-move" style="animation-delay: 0.2s"></div>
                                            <div class="w-2 h-2 bg-slate-200 rounded-full absolute top-20 right-12 animate-cloud-move" style="animation-delay: 1.5s"></div>
                                            <div class="w-1.5 h-1.5 bg-slate-300 rounded-full absolute top-5 left-24 animate-cloud-move" style="animation-delay: 0.8s"></div>
                                            <div class="w-1 h-1 bg-slate-200 rounded-full absolute top-15 right-20 animate-cloud-move" style="animation-delay: 2.1s"></div>
                                        </div>

                                        <!-- Rocket -->
                                        <div class="relative z-10 animate-rocket-shake">
                                            <svg class="w-16 h-16 text-highlight-gold drop-shadow-xl" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.59 14.37a6 6 0 01-5.84 7.38v-4.8m5.84-2.58a14.98 14.98 0 006.16-12.12A14.98 14.98 0 009.631 8.41m5.96 5.96a14.926 14.926 0 01-5.841 2.58m-.119-8.54a6 6 0 00-7.381 5.84h4.8m2.581-5.84a14.927 14.927 0 00-2.58 5.84m2.609 7.19a6 6 0 011.98-4.402l.369-.366m0 0c.966-.966 2.065-1.685 3.268-2.083m0 0c1.202-.398 2.479-.498 3.709-.298m0 0a14.92 14.92 0 00-3.6-5.801m0 0a14.92 14.92 0 00-5.8 3.6m3.6 5.8a14.92 14.92 0 01-5.801-3.6m5.8 3.6a6 6 0 01-2.083 3.267"></path>
                                            </svg>
                                            <!-- Rocket Flame -->
                                            <div class="absolute -bottom-2 left-1/2 -translate-x-1/2 w-2 h-6 bg-orange-500 rounded-full blur-[2px] animate-pulse"></div>
                                        </div>
                                    </div>
                                    
                                    <p class="text-xs text-center text-slate-400 mt-3">Optimization engine active</p>
                                </div>
                            </div>

                            <!-- New Digital Marketing Animation Card -->
                            <div class="bg-gradient-to-br from-[#0f172a] to-[#1e293b] p-6 rounded-2xl shadow-xl text-white relative overflow-hidden group border border-slate-800/50">
                                <!-- Abstract Background Glow -->
                                <div class="absolute -top-10 -right-10 w-32 h-32 bg-blue-500 rounded-full blur-[50px] opacity-20 group-hover:opacity-40 transition duration-1000 animate-pulse-slow"></div>
                                <div class="absolute -bottom-10 -left-10 w-32 h-32 bg-purple-500 rounded-full blur-[50px] opacity-20 group-hover:opacity-40 transition duration-1000 animate-pulse-slow" style="animation-delay: 2s;"></div>

                                <div class="flex justify-between items-start mb-2 relative z-10">
                                    <h3 class="font-bold text-lg text-white">Market Intelligence</h3>
                                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-500/20 text-green-400 border border-green-500/30">
                                        Live
                                    </span>
                                </div>
                                <p class="text-xs text-slate-400 mb-6 relative z-10">Real-time digital performance metrics</p>

                                <!-- Animation Container -->
                                <div class="h-32 w-full relative z-10">
                                    <svg viewBox="0 0 300 120" class="w-full h-full drop-shadow-lg overflow-visible">
                                        <!-- Grid lines -->
                                        <line x1="0" y1="100" x2="300" y2="100" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
                                        <line x1="0" y1="60" x2="300" y2="60" stroke="rgba(255,255,255,0.05)" stroke-width="1" stroke-dasharray="4 4"/>
                                        <line x1="0" y1="20" x2="300" y2="20" stroke="rgba(255,255,255,0.05)" stroke-width="1" stroke-dasharray="4 4"/>
                                        
                                        <!-- Area Gradient -->
                                        <defs>
                                            <linearGradient id="areaGradient" x1="0" x2="0" y1="0" y2="1">
                                                <stop offset="0%" stop-color="#FF9728" stop-opacity="0.2"/>
                                                <stop offset="100%" stop-color="#FF9728" stop-opacity="0"/>
                                            </linearGradient>
                                        </defs>

                                        <!-- Path with animation -->
                                        <path d="M0,100 Q40,100 60,80 T120,70 T180,40 T240,30 T300,10" fill="none" stroke="#FF9728" stroke-width="3" stroke-linecap="round" stroke-dasharray="400" stroke-dashoffset="400" class="animate-draw">
                                        </path>
                                        
                                        <!-- Animated Dots -->
                                        <circle cx="60" cy="80" r="3" fill="#D2E8B8" class="animate-pulse" style="animation-delay: 0.5s"/>
                                        <circle cx="120" cy="70" r="3" fill="#D2E8B8" class="animate-pulse" style="animation-delay: 1s"/>
                                        <circle cx="180" cy="40" r="3" fill="#D2E8B8" class="animate-pulse" style="animation-delay: 1.5s"/>
                                        <circle cx="240" cy="30" r="3" fill="#D2E8B8" class="animate-pulse" style="animation-delay: 1.8s"/>
                                        <circle cx="300" cy="10" r="4" fill="#fff" class="animate-pulse" style="animation-delay: 2s"/>
                                    </svg>
                                    
                                    <!-- Floating Icons -->
                                    <div class="absolute top-0 right-10 animate-float text-xl opacity-90 filter drop-shadow-lg">ðŸš€</div>
                                    <div class="absolute bottom-4 left-10 animate-float text-xl opacity-80 filter drop-shadow-lg" style="animation-delay: 1.5s;">ðŸ“Š</div>
                                    <div class="absolute top-8 left-1/2 animate-float text-lg opacity-70 filter drop-shadow-lg" style="animation-delay: 0.8s;">ðŸŽ¯</div>
                                </div>
                                
                                <div class="mt-4 flex items-center justify-between text-xs text-slate-400 border-t border-white/5 pt-3">
                                    <span>Traffic Source: <strong>Organic</strong></span>
                                    <span class="flex items-center text-green-400 font-bold">
                                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                                        +24.5%
                                    </span>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- CONTENT: TIMELINE TAB -->
                <div x-show="activeTab === 'timeline'" x-transition class="mt-6" style="display: none;">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <h3 class="font-bold text-lg text-primary-green mb-6">Project Timeline</h3>
                        
                        <div class="relative pl-8 space-y-8">
                            <!-- Vertical Line -->
                            <div class="timeline-line"></div>

                            {% if tasks %}
                                {% for task in tasks %}
                                    <div class="relative z-10">
                                        <div class="absolute -left-8 w-6 h-6 {% if task.status == 'Done' %}bg-green-500{% elif task.status == 'In Progress' %}bg-highlight-gold{% else %}bg-slate-200{% endif %} rounded-full border-4 border-white shadow-md flex items-center justify-center">
                                            {% if task.status == 'Done' %}
                                                <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                                            {% endif %}
                                        </div>

                                        <div class="flex flex-col sm:flex-row sm:items-center justify-between bg-white border {% if task.status == 'In Progress' %}border-highlight-gold/30 shadow-lg{% else %}border-slate-100{% endif %} p-4 rounded-xl gap-3">
                                            <div class="flex-1 min-w-0">
                                                <h4 class="font-bold text-slate-800 break-words">{{ task.title }}</h4>
                                                <p class="text-xs text-slate-500">{{ task.due_date|date:"M d, Y" }} â€¢ {{ task.assignee_name|default:"Unassigned" }}</p>
                                            </div>
                                            <span class="px-3 py-1 {% if task.status == 'Done' %}bg-green-100 text-green-700{% elif task.status == 'In Progress' %}bg-orange-100 text-orange-700{% else %}bg-slate-100 text-slate-600{% endif %} text-xs font-bold rounded-full w-fit shrink-0">
                                                {{ task.status }}
                                            </span>
                                        </div>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <div class="relative z-10">
                                    <div class="bg-slate-50 p-4 rounded-xl text-center sm:text-left">
                                        <h4 class="font-bold text-slate-800">No tasks added yet</h4>
                                        <p class="text-xs text-slate-500">You can add tasks from the project management panel.</p>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

             <!-- CONTENT: DOCUMENTS TAB -->
<div x-show="activeTab === 'documents'" x-transition class="mt-6" style="display: none;">
    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">

        <!-- HEADER -->
        <div class="p-6 border-b border-slate-50 flex justify-between items-center flex-wrap gap-3">
            <h3 class="font-bold text-lg text-primary-green">Project Files</h3>

            <form method="post" enctype="multipart/form-data" action="{% url 'client:upload_project_document' project.id %}" id="uploadForm">
                {% csrf_token %}
                
                <!-- Hidden file input (removed auto-submit onchange) -->
                <input type="file" name="attachment" id="documentFile" class="hidden" />

                <!-- Upload Button & Helper Text Wrapper -->
                <div class="flex flex-col items-end gap-1">
                    <label for="documentFile" id="chooseFileBtn" class="text-sm bg-primary-green text-white hover:bg-highlight-gold px-6 py-2.5 rounded-xl font-semibold cursor-pointer whitespace-nowrap shadow-md transition-all duration-300 ease-in-out flex items-center gap-2 group transform hover:-translate-y-0.5">
                        <!-- Upload Icon -->
                        <svg class="w-5 h-5 group-hover:scale-110 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                        Upload New
                    </label>
                    
                    <!-- File Limits Label -->
                    <p class="text-[10px] text-slate-400 font-medium text-right max-w-[220px] leading-tight opacity-80">
                        Max 10 MB â€¢ JPG, PNG, PDF, DOCX
                    </p>
                </div>

                <button id="uploadSubmit" type="submit" class="hidden">Upload</button>
            </form>
        </div>

        <!-- PREVIEW ROW (NEW) -->
        <div class="p-6 border-b border-slate-50">
            <div id="filePreviewBox" class="hidden items-center justify-between bg-slate-50 p-3 rounded-xl border border-slate-200 flex gap-3">
                <div class="flex items-center gap-3 min-w-0">
                    <div class="p-2 bg-white rounded-lg border flex items-center justify-center">
                        <!-- inline svg will be injected -->
                        <svg id="filePreviewIcon" class="w-6 h-6 text-slate-600" viewBox="0 0 24 24" fill="none" stroke="currentColor"></svg>
                    </div>

                    <div class="flex flex-col min-w-0">
                        <p id="filePreviewName" class="text-sm font-medium text-slate-700"></p>
                        <p id="filePreviewInfo" class="text-xs text-slate-400">Ready to upload</p>
                    </div>
                </div>

                <div class="flex items-center gap-3">
                    <button type="button" id="removeSelectedFile" class="text-red-500 font-semibold px-3 py-1 rounded-lg hover:bg-red-50">âœ– Remove</button>
                    <button type="button" id="confirmUploadBtn" class="bg-primary-green text-white px-4 py-1.5 rounded-lg font-bold hover:bg-primary-green-hover">âœ” Upload</button>
                </div>
            </div>
        </div>

        <!-- TABLE -->
        <div class="overflow-x-auto">
            <table class="w-full text-left min-w-[600px]">
                <thead class="bg-slate-50 text-slate-500 text-xs uppercase">
                    <tr>
                        <th class="px-6 py-3 font-medium">Name</th>
                        <th class="px-6 py-3 font-medium">Uploaded By</th>
                        <th class="px-6 py-3 font-medium">Date</th>
                        <th class="px-6 py-3 font-medium text-right">Action / Status</th>
                    </tr>
                </thead>

                <tbody class="divide-y divide-slate-100">
                    {% if documents %}
                        {% for doc in documents %}
                        <tr class="hover:bg-slate-50 transition">

                            <!-- FILE NAME -->
                            <td class="px-6 py-4 flex items-center gap-3">
                                <div class="p-2 bg-slate-50 rounded-lg shrink-0">
                                    <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                                    </svg>
                                </div>

                                <span class="text-sm font-semibold text-slate-700 truncate max-w-[150px] md:max-w-none">
                                    {{ doc.attachment.name|default:"Attachment" }}
                                </span>
                            </td>

                            <!-- UPLOADED BY -->
                            <td class="px-6 py-4 text-sm whitespace-nowrap">
                                {% if doc.uploaded_by == "client" %}
                                    <span class="text-blue-600 font-semibold">You</span>
                                {% else %}
                                    <span class="text-primary-green font-semibold">Admin</span>
                                {% endif %}
                            </td>

                            <!-- DATE -->
                            <td class="px-6 py-4 text-sm text-slate-500 whitespace-nowrap">
                                {{ doc.uploaded_at|date:"M d, Y" }}
                            </td>

                            <!-- ACTION + STATUS -->
                            <td class="px-6 py-4 text-right space-y-1">

                                <!-- DOWNLOAD LINK -->
                                {% if doc.attachment %}
                                    <a href="{{ doc.attachment.url }}" target="_blank"
                                       class="text-blue-600 hover:underline text-sm font-medium block">
                                        Download
                                    </a>
                                {% endif %}

                                <!-- STATUS LABEL BLOCK -->
                                {% if doc.uploaded_by == "client" %}
                                    
                                    {% if doc.status == "pending" %}
                                        <span class="inline-block text-yellow-600 font-bold text-xs">
                                            Pending Approval
                                        </span>

                                    {% elif doc.status == "rejected" %}
                                        <span class="inline-block text-red-600 font-bold text-xs">
                                            Rejected
                                        </span>
                                        <p class="text-xs text-red-400 max-w-[180px] md:max-w-none">
                                            {{ doc.rejection_reason }}
                                        </p>

                                    {% elif doc.status == "approved" %}
                                        <span class="inline-block text-green-600 font-bold text-xs">
                                            Approved
                                        </span>
                                    {% endif %}

                                {% else %}
                                    <span class="inline-block text-primary-green font-semibold text-xs">
                                        Uploaded by Admin
                                    </span>
                                {% endif %}

                            </td>
                        </tr>
                        {% endfor %}

                    {% else %}
                        <!-- NO DOCUMENTS -->
                        <tr>
                            <td colspan="4" class="px-6 py-6 text-center text-slate-500">
                                No documents uploaded for this project.
                            </td>
                        </tr>
                    {% endif %}
                </tbody>

            </table>
        </div>
    </div>
</div>

                <!-- CONTENT: FINANCIALS -->
                <div x-show="activeTab === 'payments'" x-transition class="mt-6" style="display: none;">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Summary -->
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                            <h3 class="font-bold text-lg text-primary-green mb-4">Payment Summary</h3>

                            
                            {% if total_amount is defined and paid_amount is defined and balance_amount is defined %}
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-slate-600 font-medium">Total Amount</span>
                                        <span class="font-bold text-primary-green">â‚¹{{ total_amount }}</span>
                                    </div>

                                    <div class="flex justify-between">
                                        <span class="text-slate-600 font-medium">Amount Paid</span>
                                        <span class="font-bold text-green-600">â‚¹{{ paid_amount }}</span>
                                    </div>

                                    <div class="flex justify-between">
                                        <span class="text-slate-600 font-medium">Pending / Balance</span>
                                        <span class="font-bold text-red-600">â‚¹{{ balance_amount }}</span>
                                    </div>

                                    <!-- Make Payment Button -->
                                    <div class="pt-4 mt-2">
                                        <a href="{% url 'client:make_payment' project.id %}" class="flex items-center justify-center gap-2 w-full py-3 bg-primary-green hover:bg-highlight-gold text-white font-bold rounded-xl transition-all shadow-md hover:shadow-lg group transform hover:-translate-y-0.5">
                                            <span>Make Payment</span>
                                            <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>
                                        </a>
                                    </div>

                                    <div class="mt-4 pt-2 border-t border-slate-100">
                                        <p class="text-xs text-slate-400">
                                            Last updated: 
                                            {% if payments %}
                                                {% with last_payment=payments.last %}
                                                    {{ last_payment.payment_date|date:"M d, Y" }}
                                                {% endwith %}
                                            {% else %}
                                                N/A
                                            {% endif %}
                                        </p>
                                    </div>
                                </div>
                            {% elif payments %}
                                {% with summary=payments.0 %}
                                    <div class="space-y-3">
                                        <div class="flex justify-between">
                                        <span class="text-slate-600 font-medium">Pending / Balance</span>
                                        <span class="font-bold text-red-600">â‚¹{{ summary.balance_amount }}</span>
                                    </div>

                                    <!-- Make Payment Button -->
                                    <div class="pt-4 mt-2">
                                        <a href="{% url 'client:client_payments'%}" class="flex items-center justify-center gap-2 w-full py-3 bg-primary-green hover:bg-highlight-gold text-white font-bold rounded-xl transition-all shadow-md hover:shadow-lg group transform hover:-translate-y-0.5">
                                            <span>Make Payment</span>
                                            <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>
                                        </a>
                                    </div>

                                    <div class="mt-4 pt-2 border-t border-slate-100">
                                        <p class="text-xs text-slate-400">Last payment date: {{ summary.payment_date }}</p>
                                    </div>

                                            <div class="flex justify-between">
                                                <span class="text-slate-600 font-medium">Amount Paid</span>
                                                <span class="font-bold text-green-600">â‚¹{{ summary.amount_paid }}</span>
                                            </div>

                                            <div class="flex justify-between">
                                                <span class="text-slate-600 font-medium">Pending / Balance</span>
                                                <span class="font-bold text-red-600">â‚¹{{ summary.balance_amount }}</span>
                                            </div>

                                            <div class="mt-4 pt-2 border-t border-slate-100">
                                                <p class="text-xs text-slate-400">Last payment date: {{ summary.payment_date }}</p>
                                            </div>
                                    </div>
                                {% endwith %}
                            {% else %}
                                <p class="text-slate-500 text-sm">No payment records available for this project.</p>
                            {% endif %}
                        </div>

                        <!-- Payment Animation / Visual (REPLACED PAYMENT HISTORY) -->
                        <div class="bg-[#051c18] p-8 rounded-2xl shadow-2xl border border-primary-green/30 relative overflow-hidden group min-h-[320px] flex items-center justify-center">

                            <!-- Ambient Background Effects -->
                            <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-primary-green/20 via-[#051c18] to-[#051c18]"></div>
                            <div class="absolute inset-0 opacity-20" style="background-image: radial-gradient(#155C54 1px, transparent 1px); background-size: 20px 20px;"></div>

                            <!-- The Holographic Core -->
                            <div class="relative z-10 w-64 h-64 flex items-center justify-center">

                                <!-- Outer Rotating Ring (Slow) -->
                                <div class="absolute inset-0 rounded-full border border-primary-green/30 border-t-highlight-gold/50 w-full h-full animate-spin-slow"></div>
                                
                                <!-- Middle Rotating Ring (Reverse, Medium) -->
                                <div class="absolute inset-4 rounded-full border border-emerald-500/20 border-b-emerald-400/50 w-56 h-56 animate-spin-reverse"></div>
                                
                                <!-- Inner Rotating Ring (Fast) -->
                                <div class="absolute inset-8 rounded-full border-2 border-dashed border-primary-green/40 w-48 h-48 animate-spin-slow" style="animation-duration: 4s;"></div>

                                <!-- Central Glowing Orb -->
                                <div class="absolute w-32 h-32 rounded-full bg-gradient-to-br from-primary-green to-emerald-900 shadow-[0_0_50px_rgba(16,185,129,0.3)] flex items-center justify-center animate-pulse-slow">
                                    <!-- Inner Shield Icon -->
                                    <svg class="w-16 h-16 text-highlight-gold drop-shadow-[0_0_15px_rgba(255,151,40,0.6)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                                    </svg>
                                </div>

                                <!-- Floating Satellites -->
                                <div class="absolute w-full h-full animate-spin-slow" style="animation-duration: 12s;">
                                    <div class="absolute -top-3 left-1/2 -translate-x-1/2 w-8 h-8 bg-[#051c18] border border-highlight-gold rounded-full flex items-center justify-center shadow-lg transform hover:scale-110 transition">
                                        <span class="text-highlight-gold font-bold text-xs">â‚¹</span>
                                    </div>
                                    <div class="absolute top-1/2 -right-3 -translate-y-1/2 w-8 h-8 bg-[#051c18] border border-emerald-400 rounded-full flex items-center justify-center shadow-lg transform hover:scale-110 transition">
                                        <svg class="w-4 h-4 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                                    </div>
                                     <div class="absolute -bottom-3 left-1/2 -translate-x-1/2 w-8 h-8 bg-[#051c18] border border-blue-400 rounded-full flex items-center justify-center shadow-lg transform hover:scale-110 transition">
                                        <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg>
                                    </div>
                                </div>

                            </div>

                            <!-- Bottom Status Panel -->
                            <div class="absolute bottom-6 left-0 w-full text-center">
                                <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-white/5 border border-white/10 backdrop-blur-md">
                                    <span class="relative flex h-2 w-2">
                                      <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                                      <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                                    </span>
                                    <span class="text-xs font-mono text-emerald-400 tracking-wider">SECURE CHANNEL: ENCRYPTED</span>
                                </div>
                            </div>
                            
                        </div>

                    </div>
                </div>

            </div>
        </div>
    </main>


    <script>
document.getElementById("documentFile").addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;

    const allowed = ["jpg", "jpeg", "png", "pdf", "docx"];
    const ext = file.name.split(".").pop().toLowerCase();

    if (!allowed.includes(ext)) {
        alert("Only JPG, JPEG, PNG, PDF, DOCX files allowed.");
        this.value = "";
        return;
    }

    if (file.size > 10 * 1024 * 1024) {
        alert("File size cannot exceed 10 MB.");
        this.value = "";
        return;
    }
});
</script>

    <!--
      IMPORTANT:
      Below script replaces the simple onchange-alert logic above with a preview + remove + confirm flow.
      It intentionally keeps your original behavior for other parts of the page.
    -->
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        // Elements
        const fileInput = document.getElementById('documentFile');
        const previewBox = document.getElementById('filePreviewBox');
        const previewName = document.getElementById('filePreviewName');
        const previewInfo = document.getElementById('filePreviewInfo');
        const previewIcon = document.getElementById('filePreviewIcon');
        const removeBtn = document.getElementById('removeSelectedFile');
        const confirmBtn = document.getElementById('confirmUploadBtn');
        const submitBtn = document.getElementById('uploadSubmit');
        const chooseFileBtn = document.getElementById('chooseFileBtn');
        const form = document.getElementById('uploadForm');

        if (!fileInput) return;

        // Helper: set simple inline SVG icons depending on extension
        function setIconForExt(ext) {
            if (['jpg','jpeg','png'].includes(ext)) {
                previewIcon.innerHTML = "<path stroke-linecap='round' stroke-linejoin='round' stroke-width='1.6' d='M3 7v10a2 2 0 002 2h14a2 2 0 002-2V7M8 11l2 2 3-3 4 4'/>";
            } else if (ext === 'pdf') {
                previewIcon.innerHTML = "<path stroke-linecap='round' stroke-linejoin='round' stroke-width='1.6' d='M7 21h10a2 2 0 002-2V7l-5-5H7a2 2 0 00-2 2v14a2 2 0 002 2z' />";
            } else if (ext === 'docx') {
                previewIcon.innerHTML = "<path stroke-linecap='round' stroke-linejoin='round' stroke-width='1.6' d='M6 2h7l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zM8 14h8M8 10h8' />";
            } else {
                previewIcon.innerHTML = "<rect x='3' y='3' width='18' height='18' rx='2' ry='2' stroke-width='1.6'></rect>";
            }
        }

        // Clear preview helper
        function clearPreview() {
            fileInput.value = '';
            if (previewBox) previewBox.classList.add('hidden');
            if (previewName) previewName.textContent = '';
            if (previewInfo) previewInfo.textContent = '';
            if (previewIcon) previewIcon.innerHTML = '';
            if (confirmBtn) { confirmBtn.disabled = false; confirmBtn.textContent = 'âœ” Upload'; }
        }

        // When user picks a file, show preview (do not auto submit)
        fileInput.addEventListener('change', function (e) {
            const file = this.files[0];
            if (!file) {
                clearPreview();
                return;
            }

            const allowed = ['jpg','jpeg','png','pdf','docx'];
            const ext = (file.name.split('.').pop() || '').toLowerCase();

            // Validate file type
            if (!allowed.includes(ext)) {
                // show inline message instead of alert
                previewBox.classList.remove('hidden');
                previewName.textContent = file.name;
                previewInfo.textContent = 'âŒ Invalid file type. Allowed: JPG, PNG, PDF, DOCX';
                if (previewInfo) previewInfo.classList.add('text-red-500');
                setIconForExt('unknown');
                return;
            }

            // Validate size
            if (file.size > 10 * 1024 * 1024) {
                previewBox.classList.remove('hidden');
                previewName.textContent = file.name;
                previewInfo.textContent = 'âŒ File too large (max 10 MB)';
                if (previewInfo) previewInfo.classList.add('text-red-500');
                setIconForExt(ext);
                return;
            }

            // Valid file
            previewBox.classList.remove('hidden');
            previewName.textContent = file.name;
            previewInfo.textContent = (file.type || ext.toUpperCase()) + ' â€¢ ' + Math.round(file.size / 1024) + ' KB';
            previewInfo.classList.remove('text-red-500');
            setIconForExt(ext);
            if (confirmBtn) { confirmBtn.disabled = false; confirmBtn.textContent = 'âœ” Upload'; }
        });

        // Remove selected file (cancels choice)
        if (removeBtn) {
            removeBtn.addEventListener('click', function () {
                clearPreview();
            });
        }

        // Confirm and submit (only uploads when user clicks confirm)
        if (confirmBtn) {
            confirmBtn.addEventListener('click', function () {
                // Ensure a file is selected
                if (!fileInput.files || fileInput.files.length === 0) return;

                // Provide immediate feedback
                confirmBtn.disabled = true;
                confirmBtn.textContent = 'Uploading...';

                // Submit the form normally (server handles file save)
                form.submit();
            });
        }

        // Accessibility: pressing Enter on the label opens file dialog
        if (chooseFileBtn) {
            chooseFileBtn.addEventListener('keydown', function (e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    fileInput.click();
                }
            });
        }
    });
    </script>

</body>
</html>
