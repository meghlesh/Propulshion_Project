{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Expert Login | Propulsion Technology</title>
  <link rel="icon" type="image/png" href="{% static 'img/logo6.png'%}">
  
  <!-- Load Poppins Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Load Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Poppins', 'sans-serif'] },
          colors: {
            'primary-green': '#053830',
            'accent-green': '#D2E8B8',
            'highlight-gold': '#FF9728',
            'card-bg': '#F1F2F0',
            'dark-text': '#262626',
          },
        },
      },
    }
  </script>

  <style>
    body {
      background-color: var(--tw-colors-accent-green);
      background-image: radial-gradient(circle at center, rgba(5, 56, 48, 0.1) 1px, transparent 1px);
      background-size: 20px 20px;
    }
    .login-card {
      box-shadow: 0 10px 25px rgba(5, 56, 48, 0.15), 0 5px 10px rgba(5, 56, 48, 0.05);
    }
    .cta-button-shadow {
      box-shadow: 0 4px 15px rgba(255, 151, 40, 0.4);
    }
  </style>
</head>

<body class="min-h-screen flex items-center justify-center font-sans text-dark-text py-10 px-4 relative overflow-y-auto">

  <!-- Background -->
  <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,rgba(5,56,48,0.08)_1px,transparent_1px)] bg-[size:20px_20px] pointer-events-none fixed"></div>

  <!-- Login Card -->
  <!-- CHANGED: max-w-md to max-w-sm to make it smaller, reduced padding to p-6 md:p-8 -->
  <div class="bg-white login-card rounded-3xl p-6 md:p-8 w-full max-w-sm border border-gray-100 transition-all duration-300 hover:shadow-2xl hover:scale-[1.01] relative z-10">

    <!-- Branding -->
    <div class="flex flex-col items-center justify-center mb-6 space-y-1">
      <span class="flex flex-col leading-none text-primary-green font-extrabold tracking-tight text-center">
        <span class="text-2xl md:text-3xl font-extrabold tracking-widest leading-tight">PROPULSION</span>
        <span class="text-xs md:text-sm font-medium tracking-widest leading-tight opacity-70 text-highlight-gold">EXPERT ACCESS</span>
      </span>
    </div>

    <h2 class="text-xl md:text-2xl font-extrabold text-center text-primary-green mb-6">
      Expert Login
    </h2>

    <!-- Messages -->
    {% if messages %}
  {% for message in messages %}
    <div class="
        mb-4 p-3 rounded-lg text-sm font-semibold border
        {% if message.tags == 'success' %}
            bg-green-100 text-green-700 border-green-300
        {% elif message.tags == 'error' %}
            bg-red-100 text-red-700 border-red-300
        {% elif message.tags == 'warning' %}
            bg-yellow-100 text-yellow-700 border-yellow-300
        {% else %}
            bg-blue-100 text-blue-800 border-blue-300
        {% endif %}
      ">
      {{ message }}
    </div>
  {% endfor %}
{% endif %}

    <form id="expertLoginForm" method="POST" class="space-y-4">
      {% csrf_token %}

      <!-- Username -->
      <div>
        <label class="block text-gray-700 font-semibold mb-1 text-sm">Username *</label>
        <input type="text"
               id="expert_username"
               name="username"
               maxlength="30"
               required
               placeholder="Enter username"
               class="w-full px-4 py-2.5 border-2 border-accent-green rounded-xl bg-card-bg 
                      focus:border-primary-green focus:ring-primary-green transition-all 
                      shadow-inner placeholder-gray-400 text-sm">
      </div>

      <!-- Password with Toggle -->
      <div>
        <label class="block text-gray-700 font-semibold mb-1 text-sm">Password *</label>
        <div class="relative">
          <input type="password"
                 id="expert_password"
                 name="password"
                 maxlength="20"
                 required
                 placeholder="Enter password"
                 class="w-full px-4 py-2.5 border-2 border-accent-green rounded-xl bg-card-bg
                        focus:border-primary-green focus:ring-primary-green transition-all 
                        shadow-inner placeholder-gray-400 text-sm pr-10"> <!-- Added pr-10 for icon space -->

          <!-- Eye Icon Toggle -->
          <button type="button" 
                  class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-primary-green focus:outline-none"
                  onclick="togglePassword()">
            
            <!-- Eye Open Icon (Visible by default) -->
            <svg id="eyeOpen" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
            </svg>

            <!-- Eye Closed Icon (Hidden by default) -->
            <svg id="eyeClosed" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />
            </svg>
          </button>
        </div>
      </div>

      <!-- ❗ Error Box -->
      <p id="expertError"
         class="hidden bg-red-100 text-red-700 text-sm font-semibold text-center p-3 rounded-xl border border-red-300">
      </p>

      <button type="submit"
              class="w-full bg-primary-green text-white font-bold py-3 rounded-xl 
                     hover:bg-highlight-gold hover:text-dark-text transition-all 
                     cta-button-shadow transform hover:scale-[1.01] hover:-translate-y-0.5 text-sm md:text-base">
        Log In
      </button>
    </form>

    <!-- Register + Forgot Password -->
    <div class="mt-6 text-center border-t border-gray-100 pt-5">
      <p class="text-gray-600 text-xs mb-3">Don’t have an Expert account?</p>

      <a href="{% url 'expert_register' %}"
         class="inline-block px-5 py-2 bg-highlight-gold text-dark-text font-semibold 
                rounded-xl hover:bg-primary-green hover:text-white transition-all 
                cta-button-shadow text-xs">
        Register as Expert
      </a>

      <p class="mt-3 text-xs">
        <a href="{% url 'expert_password_reset' %}"
           class="text-primary-green hover:text-highlight-gold transition-all font-medium">
          Forgot Password?
        </a>
      </p>
    </div>

    <!-- Back to Main Website -->
    <div class="mt-6 text-center border-t border-gray-100 pt-5">
      <a href="/"
         class="inline-block bg-primary-green text-white font-bold py-2 px-6 rounded-2xl
                hover:bg-highlight-gold hover:text-dark-text transition-all 
                cta-button-shadow transform hover:scale-[1.02] hover:-translate-y-0.5 text-xs">
        Back to Main Website
      </a>
    </div>
  </div>

  <!-- Password Toggle Script -->
  <script>
    function togglePassword() {
      // FIX: Changed ID to match the actual input ID "expert_password"
      const pwd = document.getElementById("expert_password");
      const openIcon = document.getElementById("eyeOpen");
      const closedIcon = document.getElementById("eyeClosed");

      if (pwd.type === "password") {
        pwd.type = "text";
        openIcon.classList.add("hidden");
        closedIcon.classList.remove("hidden");
      } else {
        pwd.type = "password";
        openIcon.classList.remove("hidden");
        closedIcon.classList.add("hidden");
      }
    }
  </script>

  <!-- Validation Script -->
  <script>
    const expertForm = document.getElementById("expertLoginForm");
    const usernameInput = document.getElementById("expert_username");
    const passwordInput = document.getElementById("expert_password");
    const errorBox = document.getElementById("expertError");

    // show error
    function showError(message) {
      errorBox.textContent = message;
      errorBox.classList.remove("hidden");
    }
    // hide error
    function hideError() {
      errorBox.textContent = "";
      errorBox.classList.add("hidden");
    }

    // block space while typing
    usernameInput.addEventListener("keydown", (e) => { if (e.key === " ") e.preventDefault(); });
    passwordInput.addEventListener("keydown", (e) => { if (e.key === " ") e.preventDefault(); });

    // block characters after limit
    usernameInput.addEventListener("input", () => {
      if (usernameInput.value.length > 30) {
        usernameInput.value = usernameInput.value.slice(0, 30);
        showError("Username cannot exceed 30 characters.");
      } else { hideError(); }
    });
    passwordInput.addEventListener("input", () => {
      if (passwordInput.value.length > 20) {
        passwordInput.value = passwordInput.value.slice(0, 20);
        showError("Password cannot exceed 20 characters.");
      } else { hideError(); }
    });

    // submit validation
    expertForm.addEventListener("submit", (e) => {
      let username = usernameInput.value.trim();
      let password = passwordInput.value.trim();
      hideError();

      if (username.length < 4) {
        showError("Username must be at least 4 characters.");
        e.preventDefault();
        return;
      }
      if (password.length < 5) {
        showError("Password must be at least 5 characters.");
        e.preventDefault();
        return;
      }
    });
  </script>

</body>
</html>