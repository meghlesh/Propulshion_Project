{% load static %}
{% load widget_tweaks %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Apply — {{ job.title }}</title>
  <link rel="icon" type="image/png" href="{% static 'img/logo6.png'%}">
  <script src="https://cdn.tailwindcss.com"></script>

  
</head>
<body class="bg-[#F3F7F2] text-[#053830] font-sans">


<div id="pageLoader"
     class="fixed inset-0 flex flex-col items-center justify-center bg-white/70 backdrop-blur-md z-[9999] transition-all duration-700">
  <div class="relative">
    <div class="w-20 h-20 border-[5px] border-[#053830]/20 border-t-[#053830] rounded-full animate-spin"></div>
    <div class="absolute inset-2 w-16 h-16 border-[4px] border-[#FF9728]/30 border-t-[#FF9728] rounded-full animate-[spin_2.5s_linear_infinite]"></div>
  </div>
  <p class="mt-8 text-[#053830] text-lg font-semibold tracking-wide animate-pulse">Loading Application Form...</p>
</div>

  <main class="max-w-2xl mx-auto mt-12">
    <div class="bg-white p-8 rounded-2xl shadow-md">
      <h1 class="text-2xl font-bold mb-2">Apply for {{ job.title }}</h1>
      <p class="text-sm text-gray-600 mb-6">
        Please fill in all required fields. Your details and resume will be securely stored for this position.
      </p>

      {# --- Show Django messages (success / error) --- #}
      {% if messages %}
      <div class="mb-4">
        {% for message in messages %}
          <p class="p-3 rounded-lg text-sm {% if message.tags == 'error' %}bg-red-100 text-red-700{% else %}bg-green-100 text-green-700{% endif %}">
            {{ message }}
          </p>
        {% endfor %}
      </div>
      {% endif %}

      {# --- Show form non-field errors (server-side) --- #}
      {% if form.non_field_errors %}
      <div class="mb-4">
        {% for err in form.non_field_errors %}
          <p class="p-3 rounded-lg text-sm bg-red-100 text-red-700">{{ err }}</p>
        {% endfor %}
      </div>
      {% endif %}

      <form method="POST" enctype="multipart/form-data" class="space-y-4" id="jobApplyForm" novalidate>
        {% csrf_token %}

        <div>
          <label class="block text-sm font-semibold mb-1">
  Full Name <span class="text-red-600">*</span>
</label>

          {{ form.full_name }}
          {% if form.full_name.errors %}
            {% for err in form.full_name.errors %}
              <p class="text-sm text-red-600 mt-1">{{ err }}</p>
            {% endfor %}
          {% endif %}
          <p class="text-sm text-red-600 mt-1 hidden field-error" id="err-full_name"></p>
        </div>

        <div>
          <label class="block text-sm font-semibold mb-1">
  Email <span class="text-red-600">*</span>
</label>

          {{ form.email }}
          {% if form.email.errors %}
            {% for err in form.email.errors %}
              <p class="text-sm text-red-600 mt-1">{{ err }}</p>
            {% endfor %}
          {% endif %}
          <p class="text-sm text-red-600 mt-1 hidden field-error" id="err-email"></p>
        </div>

<div>
  <label class="block text-sm font-semibold mb-1">
  Phone Number <span class="text-red-600">*</span>
</label>


  <input 
      type="text" 
      id="id_phone"
      name="phone"
      value="{{ form.phone.value|default:'' }}"
      maxlength="10"
      placeholder="Enter 10-digit phone number"
      class="w-full border border-gray-300 rounded-xl px-4 py-2"
      oninput="validatePhone(this)"
      required
  >

  <p id="phoneError" class="text-red-600 text-sm mt-1 hidden">Please enter exactly 10 digits.</p>
</div>
      <div>
          <label class="block text-sm font-semibold mb-1">
  Graduation Year <span class="text-red-600">*</span>
</label>

          {{ form.graduation_year }}
          {% if form.graduation_year.errors %}
            {% for err in form.graduation_year.errors %}
              <p class="text-sm text-red-600 mt-1">{{ err }}</p>
            {% endfor %}
          {% endif %}
          <p class="text-sm text-red-600 mt-1 hidden field-error" id="err-graduation_year"></p>
        </div>

        <div>
          <label class="block text-sm font-semibold mb-1">
  Graduation Percentage / CGPA <span class="text-red-600">*</span>
</label>

          {{ form.graduation_percentage }}
          {% if form.graduation_percentage.errors %}
            {% for err in form.graduation_percentage.errors %}
              <p class="text-sm text-red-600 mt-1">{{ err }}</p>
            {% endfor %}
          {% endif %}
          <p class="text-sm text-red-600 mt-1 hidden field-error" id="err-graduation_percentage"></p>
        </div>

                <div>
                  <label class="block text-sm font-semibold mb-1">
  Work Experience (in Years) <span class="text-red-600">*</span>
</label>

                  <input 
                    type="text" 
                    id="experience_years" 
                    name="experience_years" 
                    placeholder="e.g., 1.5 = 1 year 6 months"
                    class="w-full border border-gray-300 rounded-xl px-4 py-2 focus:ring-2 focus:ring-[#053830] focus:border-[#053830] transition-all"
                    oninput="validateExperienceYears(this)"
                    required
                  >
                  <p id="experienceError" class="text-red-600 text-sm mt-1 hidden">
                    Please enter a valid number between 0 and 50 (only one decimal place allowed).
                  </p>
                </div>




        <div>
  <label class="block text-sm font-semibold mb-1">
    Key Skills <span class="text-red-600">*</span>
  </label>

  {{ form.key_skills|add_class:"w-full min-w-0 text-sm sm:text-base border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-accent outline-none transition" }}

  <!-- Helper label -->
  <p class="text-gray-500 text-xs mt-1">
    Enter your key skills (Max 100 characters)
  </p>

  <!-- Error messages from Django -->
  {% if form.key_skills.errors %}
    {% for err in form.key_skills.errors %}
      <p class="text-sm text-red-600 mt-1">{{ err }}</p>
    {% endfor %}
  {% endif %}

  <!-- Inline JS error -->
  <p class="text-sm text-red-600 mt-1 hidden field-error" id="err-key_skills"></p>
</div>


        <div>
          <label class="block text-sm font-semibold mb-1">
  Preferred Domain <span class="text-red-600">*</span>
</label>

          {{ form.preferred_domain }}
          {% if form.preferred_domain.errors %}
            {% for err in form.preferred_domain.errors %}
              <p class="text-sm text-red-600 mt-1">{{ err }}</p>
            {% endfor %}
          {% endif %}
          <p class="text-sm text-red-600 mt-1 hidden field-error" id="err-preferred_domain"></p>
        </div>

        <div>
          <label class="block text-sm font-semibold mb-1">
  Upload Resume (Max 5MB) <span class="text-red-600">*</span>
</label>

          {{ form.resume }}
          {% if form.resume.errors %}
            {% for err in form.resume.errors %}
              <p class="text-sm text-red-600 mt-1">{{ err }}</p>
            {% endfor %}
          {% endif %}
          <p class="text-sm text-red-600 mt-1 hidden field-error" id="err-resume"></p>
          <p class="text-xs text-gray-500 mt-1">PDF, DOC, DOCX up to 5 MB</p>
        </div>

        <!-- ✅ Cover Letter & Attachment Row -->
        <div class="flex flex-col sm:flex-row gap-6">
          <div class="flex-1">
            <label class="block text-sm font-semibold mb-1">Cover Letter</label>
            {{ form.cover_letter }}
            {% if form.cover_letter.errors %}
              {% for err in form.cover_letter.errors %}
                <p class="text-sm text-red-600 mt-1">{{ err }}</p>
              {% endfor %}
            {% endif %}
            <p class="text-sm text-red-600 mt-1 hidden field-error" id="err-cover_letter"></p>
          </div>
          <div class="sm:w-1/3">
            <label class="block text-sm font-semibold mb-1">Attach Cover Letter (Optional)</label>
            <input type="file" name="attachment" accept=".pdf,.doc,.docx"
                   class="block w-full text-sm text-gray-700 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none focus:ring-2 focus:ring-[#053830] focus:border-[#053830] p-2" />
            <p class="text-xs text-gray-500 mt-1">PDF, DOC, DOCX up to 5 MB</p>
            <p class="text-sm text-red-600 mt-1 hidden field-error" id="err-attachment"></p>
          </div>
        </div>

<div class="flex gap-4 pt-4">
  {% if request.user.is_staff or request.user.is_superuser %}
    <button type="button" 
            disabled 
            class="bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed opacity-70"
            title="Admins cannot apply for jobs">
      Submit Application (Disabled for Admins)
    </button>
  {% else %}
    <button type="submit" 
            class="bg-[#053830] text-white px-6 py-2 rounded-lg hover:bg-[#065a44] transition">
      Submit Application
    </button>
  {% endif %}
  
  <a href="{% url 'careers_list' %}" 
     class="px-6 py-2 border border-gray-400 rounded-lg text-gray-700 hover:bg-gray-100 transition">
    Cancel
  </a>
</div>
      </form>

    </div>
  </main>

  <script>
    // Client-side real-time validation
    (function () {
      // Utility helpers
      const byName = name => document.querySelector('[name="'+name+'"]');
      const showErr = (id, msg) => {
        const el = document.getElementById('err-' + id);
        if (!el) return;
        if (msg) {
          el.textContent = msg;
          el.classList.remove('hidden');
        } else {
          el.textContent = '';
          el.classList.add('hidden');
        }
      };

      const isFileTypeAllowed = (fileName, allowed) => {
        const lower = fileName.toLowerCase();
        return allowed.some(ext => lower.endsWith(ext));
      };

      const allowedResume = ['.pdf', '.doc', '.docx'];
      const MAX_FILE_BYTES = 5 * 1024 * 1024; // 5MB

      // Fields (based on your form variable names)
      const fields = {
        full_name: byName('full_name'),
        email: byName('email'),
        phone: byName('phone'),
        graduation_year: byName('graduation_year'),
        graduation_percentage: byName('graduation_percentage'),
        experience: byName('experience'),
        key_skills: byName('key_skills'),
        preferred_domain: byName('preferred_domain'),
        resume: byName('resume'),
        cover_letter: byName('cover_letter'),
        attachment: document.querySelector('[name="attachment"]')
      };

      // Basic validators for fields (will show one message per field)
      function validateFullName() {
        const el = fields.full_name;
        if (!el) return true;
        if (el.required && !el.value.trim()) {
          showErr('full_name', 'Full name is required.');
          return false;
        }
        showErr('full_name', '');
        return true;
      }

      function validateEmail() {
        const el = fields.email;
        if (!el) return true;
        const v = el.value.trim();
        if (el.required && !v) {
          showErr('email', 'Email is required.');
          return false;
        }
        if (v) {
          // simple email regex (client-side only)
          const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!re.test(v)) {
            showErr('email', 'Please enter a valid email address.');
            return false;
          }
        }
        showErr('email', '');
        return true;
      }

      function validatePhone() {
        const el = fields.phone;
        if (!el) return true;
        const v = el.value.trim();
        if (el.required && !v) {
          showErr('phone', 'Phone number is required.');
          return false;
        }
        if (v) {
          // allow international digits, spaces, +, -; require 6-18 digits
          const digits = v.replace(/\D/g,'');
          if (digits.length < 6 || digits.length > 18) {
            showErr('phone', 'Please enter a valid phone number.');
            return false;
          }
        }
        showErr('phone', '');
        return true;
      }

      function validateGraduationYear() {
        const el = fields.graduation_year;
        if (!el) return true;
        const v = el.value.trim();
        if (el.required && !v) {
          showErr('graduation_year', 'Graduation year is required.');
          return false;
        }
        if (v) {
          const n = parseInt(v, 10);
          if (isNaN(n) || n < 1900 || n > 2100) {
            showErr('graduation_year', 'Please enter a valid year (e.g., 2023).');
            return false;
          }
        }
        showErr('graduation_year', '');
        return true;
      }

      function validateGraduationPercentage() {
        const el = fields.graduation_percentage;
        if (!el) return true;
        const v = el.value.trim();
        if (el.required && !v) {
          showErr('graduation_percentage', 'Graduation percentage / CGPA is required.');
          return false;
        }
        if (v) {
          const n = parseFloat(v);
          if (isNaN(n) || n < 0) {
            showErr('graduation_percentage', 'Enter a valid number.');
            return false;
          }
          // basic guard: if > 10 and <=100 assume percent; if >100 or negative reject
          if (n > 100) {
            showErr('graduation_percentage', 'Value seems too large — use percentage or CGPA correctly.');
            return false;
          }
        }
        showErr('graduation_percentage', '');
        return true;
      }

      function validateExperience() {
        const el = fields.experience;
        const gradEl = fields.graduation_year;
        if (!el) return true;
        const v = el.value.trim();
        if (el.required && !v) {
          showErr('experience', 'Experience (start year) is required.');
          return false;
        }
        if (v) {
          const n = parseInt(v, 10);
          if (isNaN(n) || n < 1900 || n > 2100) {
            showErr('experience', 'Please enter a valid year for experience.');
            return false;
          }
          // Compare with graduation year if available
          if (gradEl && gradEl.value.trim()) {
            const g = parseInt(gradEl.value.trim(), 10);
            if (!isNaN(g) && n < g) {
              showErr('experience', 'Experience year cannot be before your graduation year.');
              return false;
            }
          }
        }
        showErr('experience', '');
        return true;
      }

      function validateKeySkills() {
        const el = fields.key_skills;
        if (!el) return true;
        if (el.required && !el.value.trim()) {
          showErr('key_skills', 'Please provide your key skills.');
          return false;
        }
        showErr('key_skills', '');
        return true;
      }

      function validatePreferredDomain() {
        const el = fields.preferred_domain;
        if (!el) return true;
        if (el.required && !el.value.trim()) {
          showErr('preferred_domain', 'Please select a preferred domain.');
          return false;
        }
        showErr('preferred_domain', '');
        return true;
      }

      function validateResume() {
        const el = fields.resume;
        if (!el) return true;
        // If the resume input is rendered as a file input, check file
        if (el.type === 'file') {
          const file = el.files[0];
          if (!file) {
            if (el.required) {
              showErr('resume', 'Please upload your resume (PDF/DOC/DOCX, max 5MB).');
              return false;
            } else {
              showErr('resume', '');
              return true;
            }
          }
          if (!isFileTypeAllowed(file.name, allowedResume)) {
            showErr('resume', 'Allowed formats: PDF, DOC, DOCX.');
            return false;
          }
          if (file.size > MAX_FILE_BYTES) {
            showErr('resume', 'Resume must be 5MB or smaller.');
            return false;
          }
        }
        showErr('resume', '');
        return true;
      }

      function validateAttachment() {
        const el = fields.attachment;
        if (!el) return true;
        const file = el.files[0];
        if (!file) {
          showErr('attachment', '');
          return true;
        }
        if (!isFileTypeAllowed(file.name, allowedResume)) {
          showErr('attachment', 'Allowed formats: PDF, DOC, DOCX.');
          return false;
        }
        if (file.size > MAX_FILE_BYTES) {
          showErr('attachment', 'Attachment must be 5MB or smaller.');
          return false;
        }
        showErr('attachment', '');
        return true;
      }

      // Hook up events for live validation
      try {
        if (fields.full_name) fields.full_name.addEventListener('input', validateFullName);
        if (fields.email) fields.email.addEventListener('input', validateEmail);
        if (fields.phone) fields.phone.addEventListener('input', validatePhone);
        if (fields.graduation_year) fields.graduation_year.addEventListener('input', function () {
          validateGraduationYear();
          validateExperience(); // re-check experience when graduation changes
        });
        if (fields.graduation_percentage) fields.graduation_percentage.addEventListener('input', validateGraduationPercentage);
        if (fields.experience) fields.experience.addEventListener('input', validateExperience);
        if (fields.key_skills) fields.key_skills.addEventListener('input', validateKeySkills);
        if (fields.preferred_domain) fields.preferred_domain.addEventListener('input', validatePreferredDomain);
        if (fields.resume) fields.resume.addEventListener('change', validateResume);
        if (fields.attachment) fields.attachment.addEventListener('change', validateAttachment);
      } catch (e) {
        // If a field isn't found or some unexpected error, we silently continue — server-side validation remains authoritative.
        console.warn('Validation hook error:', e);
      }

      // On submit, run all validations; if any fail, prevent submit
      const form = document.getElementById('jobApplyForm');
      form.addEventListener('submit', function (ev) {
        const validators = [
          validateFullName, validateEmail, validatePhone,
          validateGraduationYear, validateGraduationPercentage,
          validateExperience, validateKeySkills, validatePreferredDomain,
          validateResume, validateAttachment
        ];

        let ok = true;
        validators.forEach(fn => {
          try {
            if (!fn()) ok = false;
          } catch (e) {
            console.warn('Validation function threw:', e);
          }
        });

        if (!ok) {
          ev.preventDefault();
          // optionally focus first invalid field
          const first = document.querySelector('.field-error:not(.hidden)');
          if (first) {
            const id = first.id.replace('err-','');
            const fld = byName(id);
            if (fld && typeof fld.focus === 'function') fld.focus();
          }
        }
        // else allow normal submission (server-side checks will still run)
      });
    })();
  </script>
<script>
function validatePhone(input) {
  input.value = input.value.replace(/\D/g, '');
  if (input.value.length > 10) input.value = input.value.slice(0, 10);
  const error = document.getElementById('phoneError');
  if (input.value.length > 0 && input.value.length < 10) error.classList.remove('hidden');
  else error.classList.add('hidden');
}



</script>
<script>
function validatePhone(input) {
  input.value = input.value.replace(/\D/g, '');
  if (input.value.length > 10) input.value = input.value.slice(0, 10);
  const error = document.getElementById('phoneError');
  if (input.value.length > 0 && input.value.length < 10) error.classList.remove('hidden');
  else error.classList.add('hidden');
}
</script>
<script>
function validateExperienceYears(input) {
  const error = document.getElementById('experienceError');
  
  // Allow only digits and one decimal point
  let value = input.value.replace(/[^0-9.]/g, '');
  
  // Prevent multiple decimals
  if ((value.match(/\./g) || []).length > 1) {
    value = value.substring(0, value.length - 1);
  }

  // Restrict to one digit after decimal
  const match = value.match(/^(\d{0,2})(?:\.(\d{0,1}))?/);
  if (match) {
    value = match[1] + (match[2] !== undefined ? '.' + match[2] : '');
  }

  // Apply formatted value
  input.value = value;

  const num = parseFloat(value);

  // Validate range
  if (isNaN(num) || num < 0 || num > 50) {
    error.classList.remove('hidden');
    input.classList.add('border-red-500');
  } else {
    error.classList.add('hidden');
    input.classList.remove('border-red-500');
  }
}
</script>

<script>
// Fade out loader
window.addEventListener("load", () => {
  const loader = document.getElementById("pageLoader");
  if (loader) {
    loader.style.opacity = "0";
    loader.style.transform = "scale(1.05)";
    setTimeout(() => loader.style.display = "none", 800);
  }
});


</script>

<script>
function validateExperienceYears(input) {
  const error = document.getElementById('experienceError');
  
  // Allow only digits and one decimal point
  let value = input.value.replace(/[^0-9.]/g, '');
  
  // Prevent multiple decimals
  if ((value.match(/\./g) || []).length > 1) {
    value = value.substring(0, value.length - 1);
  }

  // Restrict to one digit after decimal
  const match = value.match(/^(\d{0,2})(?:\.(\d{0,1}))?/);
  if (match) {
    value = match[1] + (match[2] !== undefined ? '.' + match[2] : '');
  }

  // Apply formatted value
  input.value = value;

  const num = parseFloat(value);

  // Validate range
  if (isNaN(num) || num < 0 || num > 50) {
    error.classList.remove('hidden');
    input.classList.add('border-red-500');
  } else {
    error.classList.add('hidden');
    input.classList.remove('border-red-500');
  }
}
</script>

<script>
const form = document.getElementById("jobApplyForm");
const submitBtn = form.querySelector("button[type='submit']");
const loader = document.getElementById("pageLoader");

// Validate phone (10 digits)
function isPhoneValid() {
    const v = document.getElementById("id_phone").value.trim();
    return /^\d{10}$/.test(v);
}

// Validate experience (0–50, only one decimal)
function isExpValid() {
    const v = document.getElementById("experience_years").value.trim();

    // Empty value = NOT valid (since this field is required)
    if (v === "") return false;

    // Must be a number with optional one decimal place
    if (!/^[0-9]{1,2}(\.[0-9])?$/.test(v)) return false;

    const num = parseFloat(v);

    // Must be between 0 and 50
    if (num < 0 || num > 50) return false;

    return true;  // VALID
}


// Validate resume (required + file type + size)
function isResumeValid() {
    const file = document.querySelector("input[name='resume']").files[0];
    if (!file) return false;
    const allowed = [".pdf", ".doc", ".docx"];
    const name = file.name.toLowerCase();
    const okExt = allowed.some(ext => name.endsWith(ext));
    const okSize = file.size <= 5 * 1024 * 1024; 
    return okExt && okSize;
}

function validateForm() {
    const fields = [
        "full_name",
        "email",
        "graduation_year",
        "graduation_percentage",
        "key_skills",
        "preferred_domain",
    ];

    let valid = true;

    fields.forEach(name => {
        const el = document.querySelector([name="${name}"]);
        if (el && !el.value.trim()) valid = false;
    });

    if (!isPhoneValid()) valid = false;
    if (!isExpValid()) valid = false;
    if (!isResumeValid()) valid = false;

    submitBtn.disabled = !valid;

    submitBtn.classList.toggle("opacity-50", !valid);
    submitBtn.classList.toggle("cursor-not-allowed", !valid);
}

document.querySelectorAll("input, select, textarea")
    .forEach(el => el.addEventListener("input", validateForm));

validateForm();

// Show loader on valid form submit
let isSubmitting = false;

form.addEventListener("submit", function (e) {
    // Prevent multiple submits
    if (isSubmitting) {
        e.preventDefault();
        return;
    }

    // Stop submitting if form is invalid
    if (submitBtn.disabled) {
        e.preventDefault();
        return;
    }

    // Mark as submitting
    isSubmitting = true;

    // Show loader
    loader.classList.remove("hidden");

    // Make button look disabled but do NOT disable actual HTML button
    submitBtn.style.opacity = "0.6";
    submitBtn.style.pointerEvents = "none";
});

</script>


<script>
window.addEventListener("load", () => {
    document.getElementById("pageLoader").classList.add("hidden");
});
</script>

<!-- ============================
 APPLY JOB - FRONTEND VALIDATION
=============================== -->
<script>
document.addEventListener("DOMContentLoaded", () => {

    const form = document.getElementById("jobApplyForm");

    const fields = {
        full_name: {
            el: document.querySelector("[name='full_name']"),
            err: document.getElementById("err-full_name"),
            validate: v => /^[A-Za-z ]{3,50}$/.test(v),
            msg: "Enter a valid name (only letters, min 3 characters)"
        },
        email: {
            el: document.querySelector("[name='email']"),
            err: document.getElementById("err-email"),
            validate: v => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v),
            msg: "Enter a valid email address"
        },
        graduation_year: {
            el: document.querySelector("[name='graduation_year']"),
            err: document.getElementById("err-graduation_year"),
            validate: v => /^[0-9]{4}$/.test(v) && v >= 1980 && v <= 2035,
            msg: "Enter a valid year between 1980–2035"
        },
        graduation_percentage: {
            el: document.querySelector("[name='graduation_percentage']"),
            err: document.getElementById("err-graduation_percentage"),
            validate: v => /^(\d{1,2}(\.\d{1,2})?|100)$/.test(v),
            msg: "Enter a valid percentage (0–100)"
        },
        key_skills: {
            el: document.querySelector("[name='key_skills']"),
            err: document.getElementById("err-key_skills"),
            validate: v => v.trim().length >= 3,
            msg: "Enter at least one skill"
        },
        preferred_domain: {
            el: document.querySelector("[name='preferred_domain']"),
            err: document.getElementById("err-preferred_domain"),
            validate: v => v.trim().length >= 2,
            msg: "Please enter a domain"
        },
        cover_letter: {
            el: document.querySelector("[name='cover_letter']"),
            err: document.getElementById("err-cover_letter"),
            validate: v => v.trim().length >= 10,
            msg: "Cover letter must be at least 10 characters"
        }
    };

    /* PHONE FIELD */
    const phoneInput = document.getElementById("id_phone");
    const phoneError = document.getElementById("phoneError");

    phoneInput.addEventListener("input", () => {
        const val = phoneInput.value.trim();
        if (/^\d{10}$/.test(val)) {
            phoneError.classList.add("hidden");
        } else {
            phoneError.classList.remove("hidden");
        }
    });

    /* EXPERIENCE FIELD */
    const expInput = document.getElementById("experience_years");
    const expError = document.getElementById("experienceError");

    expInput.addEventListener("input", () => {
        const val = expInput.value.trim();
        if (/^(?:[0-9]|[1-4][0-9]|50)(?:\.[0-9])?$/.test(val)) {
            expError.classList.add("hidden");
        } else {
            expError.classList.remove("hidden");
        }
    });

    /* RESUME VALIDATION */
    const resumeInput = document.querySelector("[name='resume']");
    const resumeErr = document.getElementById("err-resume");

    resumeInput.addEventListener("change", () => {
        const file = resumeInput.files[0];
        if (!file) return;

        const allowed = ["pdf", "doc", "docx"];
        const ext = file.name.split(".").pop().toLowerCase();
        
        if (!allowed.includes(ext)) {
            resumeErr.textContent = "Allowed: PDF, DOC, DOCX only";
            resumeErr.classList.remove("hidden");
            resumeInput.value = "";
            return;
        }

        if (file.size > 5 * 1024 * 1024) {
            resumeErr.textContent = "File size must be below 5MB";
            resumeErr.classList.remove("hidden");
            resumeInput.value = "";
            return;
        }

        resumeErr.classList.add("hidden");
    });

    /* FINAL SUBMIT VALIDATION */
    form.addEventListener("submit", (e) => {
        let valid = true;

        Object.values(fields).forEach(f => {
            const value = f.el.value.trim();
            if (!f.validate(value)) {
                f.err.textContent = f.msg;
                f.err.classList.remove("hidden");
                valid = false;
            } else {
                f.err.classList.add("hidden");
            }
        });

        if (!/^\d{10}$/.test(phoneInput.value.trim())) valid = false;
        if (!/^(?:[0-9]|[1-4][0-9]|50)(?:\.[0-9])?$/.test(expInput.value.trim())) valid = false;

        if (!valid) {
            e.preventDefault();
            return;
        }

        /* SHOW LOADER */
        document.getElementById("pageLoader").classList.remove("hidden");

    });

});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const keySkills = document.getElementById("id_key_skills");
  const errEl = document.getElementById("err-key_skills");

  if (!keySkills) return;

  keySkills.addEventListener("input", () => {
    let val = keySkills.value;

    // Max 100 characters
    if (val.length > 100) {
      keySkills.value = val.slice(0, 100);
      errEl.textContent = "Maximum 100 characters allowed.";
      errEl.classList.remove("hidden");
      keySkills.classList.add("border-red-500");
      keySkills.classList.remove("border-green-500");
      return;
    }

    // Required validation
    if (val.trim().length === 0) {
      errEl.textContent = "This field is required.";
      errEl.classList.remove("hidden");
      keySkills.classList.add("border-red-500");
      keySkills.classList.remove("border-green-500");
      return;
    }

    // Clear error
    errEl.textContent = "";
    errEl.classList.add("hidden");
    keySkills.classList.remove("border-red-500");
    keySkills.classList.add("border-green-500");
  });
});
</script>
<!-- ============================
 FULL PAGE LOADER (OPTION B)
=============================== -->
<div id="pageLoader" class="hidden fixed inset-0 bg-black bg-opacity-30 backdrop-blur-sm flex items-center justify-center z-[9999]">
  <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-white"></div>
</div>



</body>
</html>