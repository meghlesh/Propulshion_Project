{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Post | {{ post.title }}</title>
    <link rel="icon" type="image/png" href="{% static 'img/logo.png'%}">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configure Tailwind to match theme colors
        tailwind.config = {
          theme: {
            extend: {
              colors: {
                'primary-green': '#053830',
                'accent-green': '#D2E8B8',
                'highlight-gold': '#FF9728',
                'primary-green-hover': '#155C54'
              },
              fontFamily: {
                'sans': ['Poppins', 'sans-serif']
              }
            }
          }
        }
    </script>
</head>
<body class="bg-[#EAF4E0] font-sans text-[#053830]">

    <!-- Navbar -->
    <nav class="bg-[#053830] text-white p-5 flex justify-between items-center shadow-lg">
        <h1 class="text-2xl font-bold">Edit Blog Post</h1>
        <div>
            <a href="{% url 'manage_blog_posts' %}" class="text-[#FF9728] font-semibold hover:text-white mr-6">Back to Posts</a>
            <a href="{% url 'admin_logout' %}" class="bg-[#FF9728] text-[#053830] px-4 py-2 rounded-xl font-semibold hover:bg-white hover:text-[#053830] transition-all">Logout</a>
        </div>
    </nav>

    <!-- Edit Post Form -->
    <main class="max-w-4xl mx-auto mt-10 p-6 bg-white rounded-3xl shadow-2xl">
        <h2 class="text-3xl font-extrabold mb-6 text-center">Edit: {{ post.title }}</h2>

        <form method="POST" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}

            <div class="grid md:grid-cols-2 gap-6">
                <!-- Title -->
                <div>
                    <label for="title" class="block font-semibold mb-2">Title</label>
                    <input type="text" id="title" name="title" value="{{ post.title }}" required
                        class="w-full border border-gray-300 rounded-xl px-4 py-2 focus:ring-2 focus:ring-primary-green focus:border-primary-green transition-all">
                </div>

                <!-- Status -->
                <div>
                    <label for="status" class="block font-semibold mb-2">Status</label>
                    <select id="status" name="status"
                        class="w-full border border-gray-300 rounded-xl px-4 py-2 focus:ring-2 focus:ring-primary-green focus:border-primary-green transition-all">
                        <option value="draft" {% if post.status == 'draft' %}selected{% endif %}>Draft</option>
                        <option value="published" {% if post.status == 'published' %}selected{% endif %}>Published</option>
                    </select>
                </div>
            </div>

            <!-- Summary -->
            <div>
                <label for="summary" class="block font-semibold mb-2">Summary</label>
                <textarea id="summary" name="summary" rows="3" required
                    class="w-full border border-gray-300 rounded-xl px-4 py-2 focus:ring-2 focus:ring-primary-green focus:border-primary-green transition-all">{{ post.summary }}</textarea>
            </div>

            <!-- Content -->
            <div>
                <label for="content" class="block font-semibold mb-2">Full Content</label>
                <textarea id="content" name="content" rows="15" required
                    class="w-full border border-gray-300 rounded-xl px-4 py-2 focus:ring-2 focus:ring-primary-green focus:border-primary-green transition-all">{{ post.content }}</textarea>
            </div>

            <!-- Featured Image -->
            <div>
                <label for="featured_image" class="block font-semibold mb-2">Featured Image</label>
                {% if post.featured_image %}
                    <p class="text-sm text-gray-600 mb-2">Current Image:</p>
                    <img src="{{ post.featured_image.url }}" alt="{{ post.title }}" class="h-32 w-auto object-cover rounded-lg mb-3 border border-gray-300">
                {% endif %}
                <input type="file" id="featured_image" name="featured_image" accept="image/*"
                    class="w-full border border-gray-300 rounded-xl px-4 py-2 bg-white">
            </div>
            
            <!-- Slug -->
            <div>
                <label for="slug" class="block font-semibold mb-2">Slug</label>
                <input type="text" id="slug" name="slug" value="{{ post.slug }}"
                    class="w-full border border-gray-300 rounded-xl px-4 py-2 focus:ring-2 focus:ring-primary-green focus:border-primary-green transition-all">
            </div>


            <!-- Update Button -->
            <div class="flex justify-center mt-6">
                <button type="submit"
                    class="bg-[#053830] text-white px-8 py-3 rounded-xl font-semibold hover:bg-[#FF9728] hover:text-[#053830] transition-all shadow-lg shadow-[#053830]/40 transform hover:scale-[1.02] hover:-translate-y-1">
                    Update Post
                </button>
            </div>
        </form>
    </main>

    <script>
        // Auto-generate slug on title edit
        document.getElementById('title').addEventListener('input', function() {
            const title = this.value.toLowerCase().trim();
            // Only auto-generate if the slug field is empty or unchanged
            const slugField = document.getElementById('slug');
            
            // FIX: Using string concatenation with double quotes inside the JS to safely embed the single-quoted Django variable output.
            // This prevents a SyntaxError if the slug itself contained a single quote (though unlikely for a slug).
            const initialSlug = "{{ post.slug|default:'' }}"; 

            if (!slugField.value || slugField.value === initialSlug) {
                slugField.value = title.replace(/[^a-z0-9]+/g, '-');
            }
        });
    </script>
</body>
</html>
