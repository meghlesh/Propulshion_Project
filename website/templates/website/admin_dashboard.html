{% load static %}
<!-- Load Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Load Alpine.js for dropdowns and mobile toggles -->
<script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
<!-- Load D3.js for the graph/chart -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
    // Configure Tailwind to use custom colors based on the finalprop2.html theme
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            // Using Poppins as per finalprop2.html
            sans: ['Poppins', 'sans-serif'],
          },
          colors: {
            // Mapped colors from finalprop2.html
            'primary-green': '#053830',       // Dark Green (Sidebar, Buttons)
            'accent-green': '#D2E8B8',        // Light Green (Secondary Accent)
            'highlight-gold': '#FF9728',      // Orange Accent (Primary Accent, Borders)
            'primary-green-hover': '#155C54', // Slightly lighter primary green for subtle hover on dark background
          },
        }
      }
    }
</script>

<style>
    /* Use Poppins font and ensure full height */
    body {
        font-family: 'Poppins', sans-serif;
        background-color: #e2e8f0; /* Keeping soft gray background for clean admin readability */
    }

    /* Custom scrollbar for better look in the sidebar and main content */
    .custom-scroll::-webkit-scrollbar {
        width: 6px;
        height: 6px;
    }
    .custom-scroll::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.2);
        border-radius: 2px;
    }
    /* Dark scrollbar for sidebar */
    .sidebar-scroll::-webkit-scrollbar-thumb {
         background-color: rgba(255, 255, 255, 0.2);
    }
    /* Light scrollbar for main content */
    .main-scroll::-webkit-scrollbar-thumb {
        background-color: rgba(0, 0, 0, 0.2);
    }

    /* Ensure the chart container is responsive and has a clear minimum height */
    .chart-container {
        width: 100%;
        max-width: 100%;
        min-height: 350px; /* Ensure visibility */
    }

    /* Active state for navigation item using new colors */
    .nav-item.active {
        background-color: #155C54; /* primary-green-hover */
        color: white;
    }
</style>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Propulsion Technology</title>

        <link rel="icon" type="image/png" href="{% static 'img/logo6.png'%}">


    
</head>
<!-- FIX: Added h-screen w-full overflow-hidden to body to prevent double scrolling -->
<body class="h-screen w-full overflow-hidden antialiased bg-gray-100" x-data="{ userDropdownOpen: false }">

    <!-- âœ¨ Universal Page Loader -->
    <div id="pageLoader"
         class="fixed inset-0 flex flex-col items-center justify-center bg-white/70 backdrop-blur-md z-[9999] transition-all duration-700">
      <div class="relative">
        <div class="w-20 h-20 border-[5px] border-[#053830]/20 border-t-[#053830] rounded-full animate-spin"></div>
        <div class="absolute inset-2 w-16 h-16 border-[4px] border-[#FF9728]/30 border-t-[#FF9728] rounded-full animate-[spin_2.5s_linear_infinite]"></div>
      </div>
      <p class="mt-8 text-[#053830] text-lg font-semibold tracking-wide animate-pulse">Loading Dashboard...</p>
    </div>

    <div id="welcome-msg" class="fixed top-19 left-1/2 transform -translate-x-1/2 bg-green-100 p-5 rounded-xl shadow-lg text-center transition-opacity duration-500 z-50">
    <h1 class="text-2xl font-bold text-green-800">
        Welcome, {{ request.user.first_name|default:request.user.username }} ðŸ‘‹
    </h1>
    <p class="text-sm text-green-700">
        Glad to see you back in the admin panel. <span id="time"></span>
    </p>
</div>

    <!-- Preserve Django/Jinja message block -->
    <!-- Fixed position to ensure it floats above content without breaking flex layout -->
    {% if messages %}
        <div class="fixed top-5 left-1/2 transform -translate-x-1/2 z-50 w-full max-w-4xl px-4">
            <div style="background:#d1e7dd;padding:1rem;border-radius:8px;color:#0f5132;font-weight:600;text-align:center;border:1px solid #badbcc;box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                {% for message in messages %}
                    {{ message }}
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <script>
    
    // Auto-hide welcome message after 5 seconds
    setTimeout(() => {
        const welcome = document.getElementById('welcome-msg');
        welcome.style.opacity = '0'; // fade out
        setTimeout(() => welcome.remove(), 500); // remove from DOM after fade
    }, 2000);
</script>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // Select the success message div (the one with the green background)
        const msg = document.querySelector('[style*="background:#d1e7dd"]');
        if (msg) {
            // Wait 3 seconds before starting fade-out
            setTimeout(() => {
                msg.style.transition = "opacity 0.6s ease"; // smooth fade
                msg.style.opacity = "0"; // fade out
                // After fade-out animation ends, remove the element from DOM
                setTimeout(() => msg.parentNode.remove(), 600);
            }, 3000);
        }
    });
    </script>


    <!-- MAIN DASHBOARD LAYOUT -->
    <!-- FIX: h-screen overflow-hidden to contain the layout -->
    <div class="flex h-screen overflow-hidden">

        <!-- 1. LEFT SIDEBAR (Themed Dark Green) -->
        <!-- FIX: flex-shrink-0 to prevent resizing, flex flex-col for internal layout -->
        <aside id="sidebar"
                class="bg-primary-green text-white w-64 flex-shrink-0 flex flex-col fixed inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition duration-200 ease-in-out z-30 shadow-2xl"
                x-ref="sidebar">

            <!-- Logo/Branding -->
            <!-- FIXED: Added pl-14 on mobile to clear the fixed toggle button -->
            <div class="flex-shrink-0 pl-14 pr-4 py-6 md:px-4 flex items-center">
                <a href="{% url 'admin_dashboard' %}" class="text-white flex items-center space-x-2">
                    <span class="text-xl sm:text-2xl font-extrabold tracking-wider">Propulsion <span class="text-highlight-gold">Admin</span></span>
                </a>
            </div>

            <!-- Navigation Links Wrapper -->
            <!-- FIX: flex-1 overflow-y-auto ensures ONLY the nav items scroll, not the logo -->
            <nav class="sidebar-nav flex-1 overflow-y-auto custom-scroll sidebar-scroll px-2 pb-4 space-y-1">
                <div>
                    <!-- Section Title (Main Menu) -->
                    <p class="text-xs font-semibold text-gray-400 uppercase tracking-widest px-4 pt-4 pb-2">Main Menu</p>

                    <!-- Navigation Items - Dashboard is active -->
                    <a href="{% url 'admin_dashboard' %}" class="nav-item active block py-2.5 px-4 rounded-lg transition duration-200 group flex items-center space-x-3 text-sm font-medium">
                        <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3"></path></svg>
                        <span>Dashboard</span>
                    </a>

                    <a href="{% url 'manage_services' %}" class="nav-item block py-2.5 px-4 rounded-lg transition duration-200 group flex items-center space-x-3 text-sm font-medium hover:bg-primary-green-hover">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.942 3.313.842 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.942 1.543-.842 3.313-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.942-3.313-.842-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.942-1.543.842-3.313 2.37-2.37a1.724 1.724 0 002.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                        <span>Manage Services</span>
                    </a>
                    
                    <a href="{% url 'manage_portfolio' %}" class="nav-item block py-2.5 px-4 rounded-lg transition duration-200 group flex items-center space-x-3 text-sm font-medium hover:bg-primary-green-hover">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l7 9 11-18"></path>
                        </svg>
                        <span>Manage Portfolio</span>
                    </a>
                    
                    <a href="{% url 'manage_blog_posts' %}" class="nav-item block py-2.5 px-4 rounded-lg transition duration-200 group flex items-center space-x-3 text-sm font-medium hover:bg-primary-green-hover">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m-7 13v-6a2 2 0 012-2h2a2 2 0 012 2v6m-4 0h6"></path></svg>
                        <span>Manage Blog Posts</span>
                    </a>

                    <a href="{% url 'manage_jobs' %}" class="nav-item block py-2.5 px-4 rounded-lg transition duration-200 group flex items-center space-x-3 text-sm font-medium hover:bg-primary-green-hover">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.563 23.563 0 0112 15.31h0c-2.372 0-4.664-.23-6.917-.682A.75.75 0 013 14.28V11.25a3.75 3.75 0 013.75-3.75h1.5a.75.75 0 01.75.75v.75a.75.75 0 001.5 0v-.75a3.75 3.75 0 013.75-3.75h1.5a.75.75 0 01.75.75v.75a.75.75 0 001.5 0V7.5a3.75 3.75 0 013.75 3.75v3.03a.75.75 0 01-.682.745z"></path>
                        </svg>
                        <span>Manage Jobs</span>
                    </a>

                    <a href="{% url 'manage_applications' %}" class="nav-item block py-2.5 px-4 rounded-lg transition duration-200 group flex items-center space-x-3 text-sm font-medium hover:bg-primary-green-hover">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg>
                        <span>Manage Applications</span>
                    </a>
                    
                    <!-- Direct link to custom Client Responses list -->
                    <a href="{% url 'manage_client_responses' %}" class="nav-item block py-2.5 px-4 rounded-lg transition duration-200 group flex items-center space-x-3 text-sm font-medium hover:bg-primary-green-hover">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8m-2 6V6a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2h14a2 2 0 002-2v-2"></path></svg>
                        <span>Client Responses</span>
                    </a>

                    <!-- Content Pages Management -->
                    <p class="text-xs font-semibold text-gray-400 uppercase tracking-widest px-4 pt-4 pb-2">Content Pages</p>

                    <a href="{% url 'manage_about_us' %}" class="nav-item block py-2.5 px-4 rounded-lg transition duration-200 group flex items-center space-x-3 text-sm font-medium hover:bg-primary-green-hover">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        <span>Manage About Us</span>
                    </a>

                    <a href="{% url 'manage_team' %}" class="nav-item block py-2.5 px-4 rounded-lg transition duration-200 group flex items-center space-x-3 text-sm font-medium hover:bg-primary-green-hover">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        <span>Manage Team</span>
                    </a>

                    <a href="{% url 'manage_mission' %}" class="nav-item block py-2.5 px-4 rounded-lg transition duration-200 group flex items-center space-x-3 text-sm font-medium hover:bg-primary-green-hover">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-3-3v6m1-13h-2a2 2 0 00-2 2v2H6a2 2 0 00-2 2v4a2 2 0 002 2h2v2a2 2 0 002 2h2"></path>
                        </svg>
                        <span>Manage Mission</span>
                    </a>

                    <a href="{% url 'manage_our_values' %}" class="nav-item block py-2.5 px-4 rounded-lg transition duration-200 group flex items-center space-x-3 text-sm font-medium hover:bg-primary-green-hover">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        <span>Manage Our Values</span>
                    </a>

                    <a href="{% url 'manage_privacy' %}" class="nav-item block py-2.5 px-4 rounded-lg transition duration-200 group flex items-center space-x-3 text-sm font-medium hover:bg-primary-green-hover">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        <span>Manage Privacy</span>
                    </a>

                    <a href="{% url 'manage_terms' %}" class="nav-item block py-2.5 px-4 rounded-lg transition duration-200 group flex items-center space-x-3 text-sm font-medium hover:bg-primary-green-hover">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        <span>Manage Terms</span>
                    </a>

                    <a href="{% url 'manage_feedback' %}" class="nav-item block py-2.5 px-4 rounded-lg transition duration-200 group flex items-center space-x-3 text-sm font-medium hover:bg-primary-green-hover">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 9l-2 2m0 0l-2-2m2 2V5m0 4v10m0-4l2-2m-2 2l-2 2" />
                        </svg>
                        <span>Manage Feedback</span>
                    </a>

                    <p class="text-xs font-semibold text-gray-400 uppercase tracking-widest px-4 pt-4 pb-2">Expert Request Management</p>

                    <a href="{% url 'manage_expert_registrations' %}" class="nav-item block py-2.5 px-4 rounded-lg transition duration-200 group flex items-center space-x-3 text-sm font-medium hover:bg-primary-green-hover">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-2m-4-1v8m0 0v8m0-8h8m-8 0H4"></path>
                        </svg>
                        <span>Manage Expert Request</span>
                    </a>


                    <!-- Expert Queries Section -->
                    <p class="text-xs font-semibold text-gray-400 uppercase tracking-widest px-4 pt-4 pb-2">Expert Query Management</p>

                    <a href="{% url 'manage_expert_queries' %}" class="nav-item block py-2.5 px-4 rounded-lg transition duration-200 group flex items-center space-x-3 text-sm font-medium hover:bg-primary-green-hover">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        <span>Pending Queries</span>
                    </a>

                    <!-- Assigned Queries -->
                    <a href="{% url 'manage_assigned_queries' %}" class="nav-item block py-2.5 px-4 rounded-lg transition duration-200 group flex items-center space-x-3 text-sm font-medium hover:bg-primary-green-hover">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span>Total Assigned Queries</span>
                    </a>

                    <!-- Declined Queries -->
                    <a href="{% url 'manage_declined_queries' %}" class="nav-item block py-2.5 px-4 rounded-lg transition duration-200 group flex items-center space-x-3 text-sm font-medium hover:bg-primary-green-hover">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span>Total Declined Queries</span>
                    </a>

                    <a href="{% url 'manage_demo_requests' %}" class="nav-item block py-2.5 px-4 rounded-lg transition duration-200 group flex items-center space-x-3 text-sm font-medium hover:bg-primary-green-hover">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <span>Demo Schedules</span>
                    </a>


                    <!-- CLIENT PAGES SECTION -->
                    <p class="text-xs font-semibold text-gray-400 uppercase tracking-widest px-4 pt-6 pb-2">
                        Client Pages
                    </p>

                    <!-- Add Manage Clients link -->
                    <a href="{% url 'manage_clients' %}"
                       class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-300 hover:text-white hover:bg-primary-green-hover transition">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M16 11V7a4 4 0 10-8 0v4M5 20h14a1 1 0 001-1v-5a4 4 0 00-4-4H8a4 4 0 00-4 4v5a1 1 0 001 1z"/>
                        </svg>
                        <span class="font-medium">Manage Clients</span>
                    </a>

                    <a href="{% url 'assign_project' %}"
                       class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-300 hover:text-white hover:bg-primary-green-hover transition">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M12 4v16m8-8H4"/>
                        </svg>
                        <span class="font-medium">Assign Client Project</span>
                    </a>

                    <a href="{% url 'admin_project_list' %}"
                       class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-300 hover:text-white hover:bg-primary-green-hover transition">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7h18M3 12h18M3 17h18" />
                        </svg>
                        <span class="font-medium">All Assigned Projects</span>
                    </a>

                    <a href="{% url 'payment_requests_list' %}"
                       class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-300 hover:text-white hover:bg-primary-green-hover transition">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2"/>
                        </svg>
                        <span class="font-medium">Client Payments</span>
                    </a>

                    <a href="{% url 'admin_client_register' %}"
                       class="nav-item block py-2.5 px-4 rounded-lg transition duration-200 group flex 
                              items-center space-x-3 text-sm font-medium hover:bg-primary-green-hover">
                        <svg class="w-5 h-5 text-gray-300 group-hover:text-white" fill="none"
                             viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M12 4v16m8-8H4"/>
                        </svg>
                        <span>Client Register</span>
                    </a>

                    <!-- Spacer -->
                    <div class="h-24"></div>
                </div>

                <!-- Scroll to Top Button (Hidden in Nav now, moved to global context) -->
            </nav>
            <!-- Scroll to Top Button is usually outside nav to prevent it from scrolling with the nav content if it is fixed -->
             <button id="scrollTopBtn"
                    class="fixed bottom-6 right-6 bg-highlight-gold text-white p-3 rounded-full shadow-lg 
                           hover:bg-primary-green-hover transition-all duration-300 hidden z-[9999]">
                â†‘
            </button>
        </aside>

        <!-- 2. MAIN CONTENT AREA -->
        <!-- FIX: flex-1 flex flex-col h-full overflow-hidden ensures the main area takes remaining space and handles its own scroll -->
        <div class="flex-1 flex flex-col h-full overflow-hidden">

            <!-- Top Header Bar (White) -->
            <!-- FIX: flex-shrink-0 to ensure header stays fixed size -->
            <!-- FIXED: Added pl-14 on mobile to clear the fixed toggle button -->
            <header class="flex-shrink-0 flex items-center justify-between p-4 pl-14 md:pl-4 bg-white border-b border-gray-200 shadow-sm sticky top-0 z-20">
                <h1 class="text-lg sm:text-2xl font-bold text-gray-800 truncate">Admin Control Panel</h1>

                <!-- Right Side: Search and User Profile/Logout -->
                <div class="flex items-center space-x-4">
                
                    <!-- Search Input -->
                    <div class="hidden sm:block">
                        <input type="text" placeholder="Search..." class="px-3 py-1.5 border border-gray-300 rounded-lg focus:ring-highlight-gold focus:border-highlight-gold transition duration-150 text-sm">
                    </div>

                    <!-- User Profile/Dropdown -->
                    <div class="relative" x-data="{ open: false }">
                        <button @click="open = !open" class="flex items-center space-x-2 focus:outline-none">
                            <div class="h-9 w-9 bg-highlight-gold rounded-full flex items-center justify-center text-primary-green font-semibold text-sm shadow-md">
                                {{ request.user.username|make_list|first|upper|default:'AD' }}
                            </div>
                            <span class="text-sm font-medium text-gray-700 hidden sm:inline">{{ request.user.username|default:'Admin' }}</span>
                            <svg class="w-4 h-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>

                        <!-- Dropdown Menu -->
                        <div x-show="open"
                            @click.away="open = false"
                            x-transition:enter="transition ease-out duration-100"
                            x-transition:enter-start="transform opacity-0 scale-95"
                            x-transition:enter-end="transform opacity-100 scale-100"
                            x-transition:leave="transition ease-in duration-75"
                            x-transition:leave-start="transform opacity-100 scale-100"
                            x-transition:leave-end="transform opacity-0 scale-95"
                            class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl py-1 z-50 origin-top-right ring-1 ring-black ring-opacity-5">
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center space-x-2">
                                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                <span>Profile</span>
                            </a>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center space-x-2">
                                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.942 3.313.842 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.942 1.543-.842 3.313-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.942-3.313-.842-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.942-1.543.842-3.313 2.37-2.37a1.724 1.724 0 002.572-1.065z"></path></svg>
                                <span>Settings</span>
                            </a>
                            <div class="border-t border-gray-100"></div>
                            <a href="{% url 'admin_logout' %}" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center space-x-2">
                                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                                <span>Logout</span>
                            </a>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Page Content (Dashboard Cards) -->
            <!-- FIX: flex-1 overflow-y-auto ensures this section scrolls independently -->
            <main class="flex-1 overflow-y-auto overflow-x-hidden p-4 sm:p-6 md:p-8 custom-scroll main-scroll">

                <!-- Welcome Banner -->
                <div class="bg-white p-6 rounded-xl shadow-lg mb-8 border-l-4 border-highlight-gold">
                    <h2 class="text-xl font-semibold text-gray-800">Welcome back, {{ request.user.username|default:'Admin' }}!</h2>
                    <p class="text-gray-600 mt-1">Quick summary of recent activity.</p>
                </div>

                <!-- Quick Summary Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">

                    <!-- Card 1: Services Count -->
                    <div class="bg-white p-5 rounded-xl shadow-md flex items-center justify-between border-l-4 border-highlight-gold">
                        <div>
                            <p class="text-sm text-gray-500 font-medium">Total Services</p>
                            <!-- Use the Django context data -->
                            <p class="text-3xl font-bold text-gray-900 mt-1">{{ services|length }}</p>
                        </div>
                        <a href="{% url 'manage_services' %}" class="text-highlight-gold bg-highlight-gold/10 p-3 rounded-full hover:bg-highlight-gold/20 transition">
                            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.942 3.313.842 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.942 1.543-.842 3.313-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.942-3.313-.842-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.942-1.543.842-3.313 2.37-2.37a1.724 1.724 0 002.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                        </a>
                    </div>

                    <!-- Card 2: Assigned Queries -->
                    <div class="bg-white p-5 rounded-xl shadow-md flex items-center justify-between border-l-4 border-primary-green">
                        <div>
                            <p class="text-sm text-gray-500 font-medium">Assigned Queries</p>
                            <!-- Use the Django context data -->
                            <p class="text-3xl font-bold text-gray-900 mt-1">{{ total_assigned_queries }}</p>
                        </div>
                        <a href="{% url 'manage_assigned_queries' %}"
                            class="text-primary-green bg-primary-green/10 p-3 rounded-full hover:bg-primary-green/20 transition">
                            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </a>
                    </div>

                    <!-- Card 3: Declined Queries -->
                    <div class="bg-white p-5 rounded-xl shadow-md flex items-center justify-between border-l-4 border-highlight-gold">
                        <div>
                            <p class="text-sm text-gray-500 font-medium">Declined Queries</p>
                            <p class="text-3xl font-bold text-gray-900 mt-1">{{ total_declined_queries }}</p>
                        </div>
                        <a href="{% url 'manage_declined_queries' %}" class="text-highlight-gold bg-highlight-gold/10 p-3 rounded-full hover:bg-highlight-gold/20 transition">
                           <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </a>
                    </div>

                    <!-- Card 4: Draft Blog Posts -->
                    <div class="bg-white p-5 rounded-xl shadow-md flex items-center justify-between border-l-4 border-primary-green">
                        <div>
                            <p class="text-sm text-gray-500 font-medium">Draft Blog Posts</p>
                            <p class="text-3xl font-bold text-gray-900 mt-1">{{ draft_count }}</p>
                        </div>
                        <a href="{% url 'manage_blog_posts' %}" class="text-primary-green bg-primary-green/10 p-3 rounded-full hover:bg-primary-green/20 transition">
                            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m-7 13v-6a2 2 0 012-2h2a2 2 0 012 2v6m-4 0h6"></path></svg>
                        </a>
                    </div>

                </div>

                <!-- Graph/Chart Section and Recent Messages Table -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Graph Section (2/3 width) -->
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">Monthly Traffic Overview</h2>
                        <div id="traffic-chart" class="chart-container">
                            <!-- D3 Chart will be rendered here -->
                        </div>
                    </div>

                    <!-- Recent Messages Table (1/3 width) -->
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">Recent Client Messages</h2>
                        <ul class="divide-y divide-gray-100">
                            {% for message in contact_messages %}
                            <li class="py-3 hover:bg-gray-50 transition-colors rounded-lg px-2">
                                <p class="text-sm font-semibold text-gray-800 truncate">
                                    {{ message.name }} ({{ message.subject }})
                                </p>
                                <p class="text-xs text-gray-500 mt-1">{{ message.message|truncatechars:50 }}</p>
                                <p class="text-xs text-gray-400 mt-1">{{ message.submitted_at|date:"M d, H:i" }}</p>
                            </li>
                            {% empty %}
                            <li class="py-4 text-center text-gray-500">No new messages.</li>
                            {% endfor %}
                        </ul>
                        {% if contact_messages %}
                        <div class="mt-4 text-center">
                            <a href="{% url 'manage_client_responses' %}"
                               class="text-sm font-medium text-highlight-gold hover:text-primary-green transition-colors">
                                View All Messages â†’
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>


                <!-- Footer -->

                <footer class="text-center text-gray-500 pt-10 pb-4 text-sm">
                    <div class="max-w-7xl mx-auto px-4">

                        <!-- Back to Home Button -->
                        <div class="mb-4">
                            <a href="{% url 'home' %}"
                                class="bg-[#053830] text-white px-8 py-3 rounded-xl font-semibold hover:bg-[#FF9728] hover:text-[#053830] transition-all shadow-lg shadow-[#053830]/40 transform hover:scale-[1.02] hover:-translate-y-1">
                                â¬… Back to Home
                            </a>
                        </div>
                        <p>Â© 2025 <span class="text-highlight-gold font-semibold">Propulsion Technology</span>. All Rights Reserved.</p>
                    </div>
                </footer>
            </main>
        </div>
    </div>
    

    <!-- Mobile Menu Toggle Button (Must be accessed by JavaScript) -->
    <button id="mobile-menu-btn" class="fixed top-4 left-4 p-2 bg-primary-green text-white rounded-lg md:hidden z-40">
        <svg id="menu-icon-open" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
        <svg id="menu-icon-close" class="w-6 h-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
    </button>

    <script>
        // --- D3 Chart Logic ---
        function renderChart() {
            // Sample Data: Monthly visits
            const data = [
                { month: "Jan", visits: 120 },
                { month: "Feb", visits: 180 },
                { month: "Mar", visits: 150 },
                { month: "Apr", visits: 220 },
                { month: "May", visits: 300 },
                { month: "Jun", visits: 250 },
                { month: "Jul", visits: 350 },
                { month: "Aug", visits: 420 },
                { month: "Sep", visits: 380 },
                { month: "Oct", visits: 500 },
                { month: "Nov", visits: 450 },
                { month: "Dec", visits: 550 },
            ];

            const margin = { top: 20, right: 20, bottom: 40, left: 50 };
            const container = document.getElementById('traffic-chart');
            if (!container) return; // Exit if container is not found

            // Use client dimensions for responsiveness
            const width = container.clientWidth - margin.left - margin.right;
            const height = container.clientHeight - margin.top - margin.bottom;

            // Clear existing SVG before redrawing (important for resizing)
            d3.select(container).select("svg").remove();

            const svg = d3.select(container)
                .append("svg")
                .attr("width", container.clientWidth)
                .attr("height", container.clientHeight)
                .append("g")
                // FIX: Use standard string concatenation for D3 translation
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            // Scales
            const x = d3.scaleBand()
                .domain(data.map(d => d.month))
                .range([0, width])
                .padding(0.3); // Increased padding for better bar visibility

            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.visits) * 1.1]) // Add 10% padding
                .range([height, 0]);

            // Axes
            svg.append("g")
                // FIX: Use standard string concatenation for D3 translation
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x).tickSizeOuter(0))
                .selectAll("text")
                .style("fill", "#6b7280");

            svg.append("g")
                .call(d3.axisLeft(y))
                .selectAll("text")
                .style("fill", "#6b7280");

            // Grid lines
            svg.append("g")
                .attr("class", "grid")
                // FIX: Use standard string concatenation for D3 translation
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x).tickSize(-height).tickFormat(""))
                .style("stroke", "#e5e7eb");

            svg.append("g")
                .attr("class", "grid")
                // FIX: Use standard string concatenation for D3 translation
                .call(d3.axisLeft(y).tickSize(-width).tickFormat(""))
                .style("stroke", "#e5e7eb");

            // Define a gradient for the bars (USING NEW THEME COLORS)
            const gradient = svg.append("defs")
                .append("linearGradient")
                .attr("id", "barGradient")
                .attr("x1", "0%")
                .attr("y1", "0%")
                .attr("x2", "0%")
                .attr("y2", "100%");

            gradient.append("stop")
                .attr("offset", "0%")
                .attr("stop-color", "#FF9728"); // highlight-gold (lighter top)

            gradient.append("stop")
                .attr("offset", "100%")
                .attr("stop-color", "#053830"); // primary-green (darker bottom)

            // Bars
            svg.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", d => x(d.month))
                .attr("y", height) // Start from bottom for animation
                .attr("width", x.bandwidth())
                .attr("height", 0) // Start with zero height for animation
                .attr("fill", "url(#barGradient)") // Use gradient fill
                .attr("rx", 4) // Rounded top corners
                .transition()
                .duration(800)
                .attr("y", d => y(d.visits))
                .attr("height", d => height - y(d.visits));
        }

        // --- Sidebar Toggling Logic ---
        function setupSidebarToggle() {
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const menuIconOpen = document.getElementById('menu-icon-open');
            const menuIconClose = document.getElementById('menu-icon-close');

            // Defensive check
            if (!mobileMenuBtn || !sidebar) return;

            mobileMenuBtn.addEventListener('click', () => {
                const isSidebarOpen = sidebar.classList.contains('-translate-x-full');

                if (isSidebarOpen) {
                    sidebar.classList.remove('-translate-x-full');
                    menuIconOpen.classList.add('hidden');
                    menuIconClose.classList.remove('hidden');
                } else {
                    sidebar.classList.add('-translate-x-full');
                    menuIconOpen.classList.remove('hidden');
                    menuIconClose.classList.add('hidden');
                }
            });

            // Close sidebar when clicking a link on mobile
            document.querySelectorAll('#sidebar a').forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth < 768) { // md breakpoint in Tailwind is 768px
                        sidebar.classList.add('-translate-x-full');
                        menuIconOpen.classList.remove('hidden');
                        menuIconClose.classList.add('hidden');
                    }
                });
            });
        }

        // --- Initialization and Responsiveness ---
        // Run all initialization logic after the DOM content is fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            renderChart();
            setupSidebarToggle();
        });

        // Re-render chart on resize
        window.addEventListener('resize', renderChart);
    </script>

    <script>
    window.addEventListener("load", () => {
      const loader = document.getElementById("pageLoader");
      if (loader) {
        loader.style.opacity = "0";
        loader.style.transform = "scale(1.05)";
        setTimeout(() => loader.style.display = "none", 800);
      }
    });
    </script>

    <script>
    // Logic to handle scroll to top inside the main content area
    const mainContent = document.querySelector('main'); 
    const scrollBtn = document.getElementById("scrollTopBtn");

    // Attach scroll listener to the main content area instead of window
    if(mainContent && scrollBtn) {
        mainContent.addEventListener("scroll", () => {
            if (mainContent.scrollTop > 200) {
                scrollBtn.classList.remove("hidden");
            } else {
                scrollBtn.classList.add("hidden");
            }
        });

        // Scroll to top smoothly
        scrollBtn.addEventListener("click", () => {
            mainContent.scrollTo({ top: 0, behavior: "smooth" });
        });
    }
    </script>
    
</body>
</html>