{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Candidate Login | Propulsion Technology</title>
  <link rel="icon" type="image/png" href="{% static 'img/logo6.png' %}">
  
  <!-- Load Poppins Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Load Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Poppins', 'sans-serif'] },
          colors: {
            'primary-green': '#053830',
            'accent-green': '#D2E8B8',
            'highlight-gold': '#FF9728',
            'card-bg': '#F1F2F0',
            'dark-text': '#262626',
          },
        },
      },
    }
  </script>

  <style>
    body {
      background-color: var(--tw-colors-accent-green);
      background-image: radial-gradient(circle at center, rgba(5, 56, 48, 0.1) 1px, transparent 1px);
      background-size: 20px 20px;
    }
    .login-card {
      box-shadow: 0 10px 25px rgba(5, 56, 48, 0.15), 0 5px 10px rgba(5, 56, 48, 0.05);
    }
    .cta-button-shadow {
      box-shadow: 0 4px 15px rgba(255, 151, 40, 0.4);
    }
    /* Simple fade in animation */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeIn {
      animation: fadeIn 0.5s ease-out forwards;
    }
  </style>
</head>

<!-- CHANGED: Removed 'overflow-hidden' and added 'overflow-y-auto' -->
<body class="min-h-screen flex items-center justify-center font-sans text-dark-text py-10 px-4 relative overflow-y-auto">

  <!-- Background Pattern (Changed to fixed so it stays consistent while scrolling) -->
  <div class="fixed inset-0 bg-[radial-gradient(circle_at_center,rgba(5,56,48,0.08)_1px,transparent_1px)] bg-[size:20px_20px] pointer-events-none z-0"></div>

  <!-- Login Card -->
  <div class="bg-white login-card rounded-3xl p-8 md:p-10 w-full max-w-md border border-gray-100 transition-all duration-300 hover:shadow-2xl hover:scale-[1.01] relative z-10 animate-fadeIn">

    <!-- Branding -->
    <div class="flex flex-col items-center justify-center mb-6 space-y-1">
      <span class="flex flex-col leading-none text-primary-green font-extrabold tracking-tight text-center">
        <span class="text-3xl md:text-4xl font-extrabold tracking-widest leading-tight">PROPULSION</span>
        <!-- Changed to Candidate Access -->
        <span class="text-sm md:text-base font-medium tracking-widest leading-tight opacity-70 text-highlight-gold">CANDIDATE ACCESS</span>
      </span>
    </div>

    <h2 class="text-2xl md:text-3xl font-extrabold text-center text-primary-green mb-6">
      Candidate Login
    </h2>

    <!-- Django Messages -->
    {% if messages %}
    <div class="mb-4 space-y-2">
      {% for message in messages %}
      <div class="alert-box flex items-center gap-3 px-4 py-3 rounded-xl shadow-sm text-sm font-medium
        {% if message.tags == 'success' %}bg-green-100 text-green-800 border border-green-200
        {% elif message.tags == 'error' %}bg-red-100 text-red-700 border border-red-200
        {% else %}bg-yellow-100 text-yellow-800 border border-yellow-200{% endif %}">
        <span>
           {% if message.tags == 'success' %}✔{% elif message.tags == 'error' %}❌{% else %}⚠{% endif %}
        </span>
        <span>{{ message }}</span>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Form -->
    <form id="candidateLoginForm" method="POST" class="space-y-5" novalidate>
      {% csrf_token %}
      <input type="hidden" name="next" value="{{ next }}">

      <!-- Username -->
      <div>
        <label class="block text-gray-700 font-semibold mb-2">Username *</label>
        <input type="text"
               id="candidate_username"
               name="username"
               maxlength="30"
               autocomplete="off"
               placeholder="Enter Username (max 30)"
               class="w-full px-4 py-2.5 border-2 border-accent-green rounded-xl bg-card-bg 
                      focus:border-primary-green focus:ring-primary-green transition-all 
                      shadow-inner placeholder-gray-400 outline-none">
      </div>

      <!-- Password -->
      <div>
        <label class="block text-gray-700 font-semibold mb-2">Password *</label>
        <div class="relative">
          <input type="password"
                 id="candidate_password"
                 name="password"
                 maxlength="20"
                 autocomplete="off"
                 placeholder="Enter Password (max 20)"
                 class="w-full px-4 py-2.5 border-2 border-accent-green rounded-xl bg-card-bg
                        focus:border-primary-green focus:ring-primary-green transition-all 
                        shadow-inner placeholder-gray-400 outline-none pr-10">

          <!-- Toggle Icon -->
          <span class="absolute right-4 top-3 cursor-pointer" onclick="togglePassword()">
            <!-- Eye Open -->
            <svg id="eyeOpen" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
            </svg>
            <!-- Eye Closed -->
            <svg id="eyeClosed" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-gray-600 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7a9.97 9.97 0 012.31-4.568m3.672-2.568A9.956 9.956 0 0112 5c4.477 0 8.268 2.943 9.542 7a9.97 9.97 0 01-1.23 2.626M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3l18 18" />
            </svg>
          </span>
        </div>
      </div>

      <!-- Error Box (Client Side) -->
      <p id="candidateErrorBox"
         class="hidden bg-red-100 text-red-700 text-sm font-semibold text-center p-3 rounded-xl border border-red-300">
      </p>

      <!-- Submit Button -->
      <button type="submit"
              id="loginBtn"
              class="w-full bg-primary-green text-white font-bold py-3 rounded-xl 
                     hover:bg-highlight-gold hover:text-dark-text transition-all 
                     cta-button-shadow transform hover:scale-[1.01] hover:-translate-y-0.5">
        Login
      </button>
    </form>

    <!-- Footer Links -->
    <div class="mt-8 text-center border-t border-gray-100 pt-6">
      <p class="text-gray-600 text-sm mb-3">Don’t have a Candidate account?</p>

      <a href="{% url 'candidate_register' %}"
         class="inline-block px-5 py-2.5 bg-highlight-gold text-dark-text font-semibold 
                rounded-xl hover:bg-primary-green hover:text-white transition-all 
                cta-button-shadow text-sm">
        Register as Candidate
      </a>

      <p class="mt-4 text-sm">
        <a href="{% url 'candidate_password_reset' %}"
           class="text-primary-green hover:text-highlight-gold transition-all font-medium">
          Forgot Password?
        </a>
      </p>
    </div>

    <!-- Back to Main -->
    <div class="mt-8 text-center border-t border-gray-100 pt-6">
      <a href="/"
         class="inline-block bg-primary-green text-white font-bold py-2 px-6 rounded-2xl
                hover:bg-highlight-gold hover:text-dark-text transition-all 
                cta-button-shadow transform hover:scale-[1.02] hover:-translate-y-0.5">
        Back to Main Website
      </a>
    </div>

    <!-- Copyright -->
    <footer class="text-xs text-gray-500 mt-6 text-center">
      © 2025 Propulsion Technology. All Rights Reserved.
    </footer>
  </div>

  <!-- Unified Logic Script -->
  <script>
    // 1. Password Toggle
    function togglePassword() {
      const pwd = document.getElementById("candidate_password");
      const eyeOpen = document.getElementById("eyeOpen");
      const eyeClosed = document.getElementById("eyeClosed");

      if (pwd.type === "password") {
        pwd.type = "text";
        eyeOpen.classList.add("hidden");
        eyeClosed.classList.remove("hidden");
      } else {
        pwd.type = "password";
        eyeOpen.classList.remove("hidden");
        eyeClosed.classList.add("hidden");
      }
    }

    // 2. Validation & Interaction Logic
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("candidateLoginForm");
      const usernameInput = document.getElementById("candidate_username");
      const passwordInput = document.getElementById("candidate_password");
      const errorBox = document.getElementById("candidateErrorBox");

      // Helper: Show Error
      function showError(message) {
        errorBox.textContent = message;
        errorBox.classList.remove("hidden");
      }

      // Helper: Hide Error
      function hideError() {
        errorBox.textContent = "";
        errorBox.classList.add("hidden");
      }

      // Rule: Block Space Key
      const blockSpace = (e) => { if (e.key === " ") e.preventDefault(); };
      usernameInput.addEventListener("keydown", blockSpace);
      passwordInput.addEventListener("keydown", blockSpace);

      // Rule: Input limits & Auto-truncate
      usernameInput.addEventListener("input", () => {
        if (usernameInput.value.length > 30) {
          usernameInput.value = usernameInput.value.slice(0, 30);
          showError("Username cannot exceed 30 characters.");
        } else {
          hideError();
        }
      });

      passwordInput.addEventListener("input", () => {
        if (passwordInput.value.length > 20) {
          passwordInput.value = passwordInput.value.slice(0, 20);
          showError("Password cannot exceed 20 characters.");
        } else {
          hideError();
        }
      });

      // 3. Submit Validation
      form.addEventListener("submit", function (e) {
        const u = usernameInput.value.trim();
        const p = passwordInput.value.trim();
        
        hideError();
        let isValid = true;
        let msg = "";

        if (u.length < 4) {
          msg = "Username must be at least 4 characters.";
          isValid = false;
        } else if (p.length < 5) {
          msg = "Password must be at least 5 characters.";
          isValid = false;
        }

        if (!isValid) {
          e.preventDefault();
          showError(msg);
        }
      });

      // 4. Auto-dismiss Django Messages
      setTimeout(() => {
        document.querySelectorAll(".alert-box").forEach((box) => {
          box.style.transition = "opacity 0.6s, transform 0.6s";
          box.style.opacity = "0";
          box.style.transform = "translateY(-10px)";
          setTimeout(() => box.remove(), 600);
        });
      }, 3000);
    });
  </script>
</body>
</html>