{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edit Feedback | Propulsion Technology</title>
    <link rel="icon" type="image/png" href="{% static 'img/logo6.png' %}">
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#EAF4E0] font-sans text-[#053830]">

    <header class="bg-[#053830] text-white shadow-2xl">
        <div class="max-w-6xl mx-auto px-6 py-16 text-center">
            <h1 class="text-5xl font-extrabold mb-4">Edit Feedback</h1>
            <p class="text-xl text-[#FF9728] font-semibold">Update client feedback details.</p>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-6 py-12">

        {% if messages %}
            <ul class="mb-4">
                {% for message in messages %}
                    <li class="text-{{ message.tags }}-600 font-semibold mb-2">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}

        <section class="bg-white rounded-3xl shadow-2xl p-8 border-l-4 border-[#FF9728]">

            <form method="POST" novalidate>
                {% csrf_token %}

                <label class="block font-semibold mb-2">Client Name <span class="text-red-600">*</span></label>

<input type="text" id="clientName" name="client_name"
       value="{{ feedback.client_name }}"
       maxlength="100"
       class="w-full px-4 py-3 border rounded-xl focus:outline-none 
              focus:ring-2 focus:ring-[#053830] mb-1">

<!-- Character counter -->
<p class="text-sm text-gray-500 text-right mb-1">
    <span id="clientNameCount">0</span>/100
</p>

<!-- Error message -->
<p id="clientNameError" class="text-red-600 text-sm"></p>


                <label class="block font-semibold mb-2">Feedback <span class="text-red-600">*</span></label>
                <textarea id="feedbackBox" name="feedback" rows="6" maxlength="300"
          class="w-full px-4 py-3 border rounded-xl focus:outline-none 
                 focus:ring-2 focus:ring-[#053830] mb-6">{{ feedback.feedback }}</textarea>
                <!-- CLIENT NAME ERROR -->
<p id="nameError" class="text-red-600 text-sm font-semibold mb-3 hidden"></p>

<!-- FEEDBACK COUNT -->
<div class="flex justify-between items-center mb-2">
    <span id="feedbackCount" class="text-sm text-gray-600">0/300</span>
</div>

<!-- FEEDBACK ERROR -->
<p id="feedbackError" class="text-red-600 text-sm font-semibold mb-3 hidden"></p>

                <button type="submit"
                        class="mt-4 bg-[#FF9728] text-white px-10 py-4 rounded-xl font-semibold 
                               hover:bg-[#053830] hover:text-[#FF9728] transition-colors duration-300 shadow">
                    Save Changes
                </button>

            </form>
        </section>

        <div class="text-center mt-16">
            <a href="{% url 'manage_feedback' %}"
               class="inline-block bg-[#053830] text-white px-10 py-4 rounded-xl font-semibold text-lg
                      hover:bg-[#FF9728] hover:text-[#053830] transition-all shadow-lg shadow-[#053830]/40 
                      transform hover:scale-105 hover:-translate-y-1">
                Back to Feedback List
            </a>
        </div>
    </main>

    <footer class="bg-[#053830] text-white text-center py-8 mt-16 shadow-2xl">
        <div class="max-w-6xl mx-auto px-6">
            <p class="text-lg font-semibold">Â© {{ now|date:"Y" }}
                <span class="text-[#FF9728]">Propulsion Technology</span>.
                All rights reserved.
            </p>
            <p class="text-sm text-gray-400 mt-2">Building the future, one innovation at a time.</p>
        </div>
    </footer>


<script>
document.addEventListener("DOMContentLoaded", function () {

    const clientName = document.getElementById("clientName");
    const nameError = document.getElementById("nameError");

    const feedbackBox = document.getElementById("feedbackBox");
    const feedbackCount = document.getElementById("feedbackCount");
    const feedbackError = document.getElementById("feedbackError");

    const form = document.querySelector("form");

    // ---------------------------
    // NAME VALIDATION
    // ---------------------------
    clientName.addEventListener("input", function () {
        const v = clientName.value.trim();

        // Remove digits instantly
        clientName.value = clientName.value.replace(/[0-9]/g, "");

        if (v === "") {
            nameError.textContent = "Client name is required.";
            nameError.classList.remove("hidden");
            clientName.classList.add("border-red-500");
        }
        else if (!/^[A-Za-z ]+$/.test(v)) {
            nameError.textContent = "Only letters are allowed.";
            nameError.classList.remove("hidden");
            clientName.classList.add("border-red-500");
        }
        else {
            nameError.textContent = "";
            nameError.classList.add("hidden");
            clientName.classList.remove("border-red-500");
        }
    });

    // ---------------------------
    // FEEDBACK CHARACTER COUNT
    // ---------------------------
    function updateFeedbackCount() {
        const length = feedbackBox.value.length;
        feedbackCount.textContent = `${length}/300`;
    }
    feedbackBox.addEventListener("input", updateFeedbackCount);
    updateFeedbackCount();

    // ---------------------------
    // FORM SUBMIT VALIDATION
    // ---------------------------
    form.addEventListener("submit", function (e) {
        let hasError = false;

        // Name validation
        if (clientName.value.trim() === "") {
            nameError.textContent = "Client name is required.";
            nameError.classList.remove("hidden");
            clientName.classList.add("border-red-500");
            hasError = true;
        }

        // Feedback validation
        if (feedbackBox.value.trim() === "") {
            feedbackError.textContent = "Feedback cannot be empty.";
            feedbackError.classList.remove("hidden");
            feedbackBox.classList.add("border-red-500");
            hasError = true;
        } else {
            feedbackError.classList.add("hidden");
            feedbackBox.classList.remove("border-red-500");
        }

        if (feedbackBox.value.length > 300) {
            feedbackError.textContent = "Feedback must be within 300 characters.";
            feedbackError.classList.remove("hidden");
            feedbackBox.classList.add("border-red-500");
            hasError = true;
        }

        if (hasError) {
            e.preventDefault();
        }
    });

});
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {

    const nameInput = document.getElementById("clientName");
    const nameCount = document.getElementById("clientNameCount");
    const nameError = document.getElementById("clientNameError");

    if (nameInput) {

        function validateNameField() {
            // Block numbers as user types
            nameInput.value = nameInput.value.replace(/[0-9]/g, "");

            const v = nameInput.value.trim();

            // Update character count
            nameCount.textContent = v.length;

            // Validation
            if (v === "") {
                nameError.textContent = "Name is required.";
                nameInput.classList.add("border-red-500");
            }
            else if (!/^[A-Za-z ]+$/.test(v)) {
                nameError.textContent = "Only letters are allowed.";
                nameInput.classList.add("border-red-500");
            }
            else if (v.length > 100) {
                nameError.textContent = "Maximum 100 characters allowed.";
                nameInput.classList.add("border-red-500");
            }
            else {
                nameError.textContent = "";
                nameInput.classList.remove("border-red-500");
            }
        }

        // Run on page load (pre-filled value)
        validateNameField();

        // Live validation
        nameInput.addEventListener("input", validateNameField);
    }
});
</script>





</body>
</html>